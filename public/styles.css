  :root {
    --bg: #0a0c10;
    --surface: #111318;
    --surface2: #181c24;
    --border: #1e2430;
    --accent: #00e5a0;
    --text: #e8ecf0;
    --muted: #9aabc4;
    --aggressive: #ff8c42;
    --moderate: #ffd166;
    --conservative: #06d6a0;
    /* Glassmorphism */
    --glass-bg: rgba(17,19,24,0.65);
    --glass-border: rgba(255,255,255,0.06);
    --glass-blur: 16px;
    --glass-shadow: 0 4px 24px rgba(0,0,0,0.4), 0 1px 0 rgba(255,255,255,0.04) inset;
    /* Glow */
    --accent-glow: 0 0 20px rgba(0,229,160,0.25);
    --accent-glow-strong: 0 0 30px rgba(0,229,160,0.4), 0 0 60px rgba(0,229,160,0.15);
    --accent-glow-subtle: 0 0 12px rgba(0,229,160,0.12);
    --aggressive-glow: 0 0 20px rgba(255,140,66,0.3);
    --moderate-glow: 0 0 20px rgba(255,209,102,0.3);
    --conservative-glow: 0 0 20px rgba(6,214,160,0.3);
    /* Gradients */
    --accent-gradient: linear-gradient(135deg, #00e5a0, #00d4ff);
    --accent-gradient-text: linear-gradient(135deg, #00e5a0, #a78bfa);
    /* Transitions */
    --transition-fast: 0.15s cubic-bezier(0.4,0,0.2,1);
    --transition-med: 0.25s cubic-bezier(0.4,0,0.2,1);
    --transition-slow: 0.4s cubic-bezier(0.4,0,0.2,1);
  }

  body.light {
    --bg: #f4f6f9;
    --surface: #ffffff;
    --surface2: #eef1f6;
    --border: #dde2ec;
    --text: #0f1623;
    --muted: #8a9ab8;
    --aggressive: #d06820;
    --moderate: #c49500;
    --conservative: #00a87a;
    --glass-bg: rgba(255,255,255,0.7);
    --glass-border: rgba(0,0,0,0.06);
    --glass-blur: 16px;
    --glass-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 0 rgba(255,255,255,0.8) inset;
    --accent-glow: 0 0 16px rgba(0,168,122,0.15);
    --accent-glow-strong: 0 0 24px rgba(0,168,122,0.2);
    --accent-glow-subtle: 0 0 10px rgba(0,168,122,0.08);
    --aggressive-glow: 0 0 16px rgba(208,104,32,0.15);
    --moderate-glow: 0 0 16px rgba(196,149,0,0.15);
    --conservative-glow: 0 0 16px rgba(0,168,122,0.15);
  }

  
  /* Theme toggle button */
  .theme-toggle {
    position: absolute;
    right: 5%;
    top: 12px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 5px 5px 5px 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: background var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast);
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    user-select: none;
    backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  }
  .theme-toggle:hover { border-color: var(--accent); color: var(--text); box-shadow:var(--accent-glow-subtle); }
  .theme-toggle-track {
    width: 28px;
    height: 16px;
    background: var(--border);
    border-radius: 8px;
    position: relative;
    transition: background 0.2s;
    flex-shrink: 0;
  }
  body.light .theme-toggle-track { background: var(--accent); }
  .theme-toggle-thumb {
    width: 12px;
    height: 12px;
    background: var(--muted);
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: transform 0.2s, background 0.2s;
  }
  body.light .theme-toggle-thumb { transform: translateX(12px); background: #000; }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Inter',sans-serif; min-height:100vh; overflow-x:hidden; padding-top:env(safe-area-inset-top); padding-bottom:env(safe-area-inset-bottom); touch-action:pan-x pan-y; }
  body::before {
    content:''; position:fixed; inset:0;
    background-image:
      radial-gradient(ellipse 80% 50% at 50% 0%, rgba(0,229,160,0.07) 0%, transparent 60%),
      linear-gradient(rgba(0,229,160,0.03) 1px,transparent 1px),
      linear-gradient(90deg,rgba(0,229,160,0.03) 1px,transparent 1px);
    background-size:100% 100%, 40px 40px, 40px 40px; pointer-events:none; z-index:0;
  }
  body.light::before { display:none; }
  body.light .panel, body.light .strategy-card, body.light .health-panel, body.light .rebalance-panel { box-shadow:var(--glass-shadow); background:var(--glass-bg); }
  body.light .strategy-card:hover { box-shadow:0 4px 18px rgba(0,0,0,0.12), var(--accent-glow-subtle); }
  .container { max-width:1400px; margin:0 auto; padding:0 24px; }
  header {
    padding:28px 5% 20px;
    display:flex; flex-direction:column; gap:6px;
    border-bottom:1px solid var(--glass-border);
    position:sticky; top:0; z-index:10001;
    background:var(--glass-bg);
    backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
    box-shadow:0 4px 30px rgba(0,0,0,0.3);
    transition:padding 0.25s ease, gap 0.25s ease;
  }
  header::after {
    content:''; position:absolute; bottom:-1px; left:0; right:0; height:1px;
    background:linear-gradient(90deg, transparent 0%, rgba(0,229,160,0.4) 30%, rgba(0,229,160,0.6) 50%, rgba(0,229,160,0.4) 70%, transparent 100%);
    pointer-events:none;
  }
  header.header-compact {
    padding:10px 5% 10px;
    gap:0;
  }
  header.header-compact .tagline { font-size:10px; margin-left:0; opacity:0.5; }
  header.header-compact .logo-icon { width:28px; height:28px; }
  header.header-compact .logo-icon::before { border-bottom-width:9px; top:2px; border-left-width:3px; border-right-width:3px; }
  header.header-compact .logo-icon::after { border-top-width:9px; bottom:2px; border-left-width:3px; border-right-width:3px; }
  header.header-compact .logo-icon-center { width:3px; height:3px; }
  header.header-compact .logo h1 { font-size:22px; }
  header.header-compact .logo { gap:8px; }
  .header-actions {
    position:absolute; right:5%; top:12px;
    display:flex; align-items:center; gap:8px;
  }
  /* User pill in header */
  .user-pill {
    display:flex; align-items:center; gap:6px;
    background:var(--surface2); border:1px solid var(--border); border-radius:20px;
    padding:4px 12px 4px 10px; cursor:pointer;
    font-family:'DM Sans',sans-serif; font-size:12px; font-weight:600;
    color:var(--text); transition:border-color 0.2s, background 0.2s;
    white-space:nowrap;
  }
  .user-pill:hover { border-color:var(--accent); }
  .user-pill-avatar {
    width:22px; height:22px; border-radius:50%; display:none;
    border:1.5px solid var(--accent); object-fit:cover;
  }
  .user-pill-avatar.visible { display:block; }
  .user-pill-avatar.initials {
    display:flex; align-items:center; justify-content:center;
    background:var(--surface2); color:var(--accent);
    font-size:10px; font-weight:700; font-family:'DM Sans',sans-serif;
    border:1.5px solid var(--accent); width:22px; height:22px; border-radius:50%;
  }
  .user-pill-chevron { font-size:10px; color:var(--muted); }
  .switcher-save-btn {
    background: rgba(0,229,160,0.1); border: 1px solid rgba(0,229,160,0.3); border-radius: 8px;
    padding: 5px 12px; cursor: pointer;
    font-family: 'Space Mono', monospace; font-size: 10px; font-weight: 700; color: var(--accent);
    letter-spacing: 0.5px; transition: border-color 0.2s, background 0.2s;
    white-space: nowrap;
  }
  .switcher-save-btn:hover { border-color: var(--accent); background: rgba(0,229,160,0.18); }
  .logo { display:flex; align-items:center; gap:12px; }
  .logo-icon {
    width:42px; height:42px;
    border:1.5px solid #2a3140;
    border-radius:50%;
    position:relative;
    display:flex; align-items:center; justify-content:center;
    background:var(--bg);
    flex-shrink:0;
  }
  .logo-icon::before {
    content:'';
    position:absolute;
    width:0; height:0;
    border-left:4px solid transparent;
    border-right:4px solid transparent;
    border-bottom:13px solid var(--accent);
    top:4px;
    filter:drop-shadow(0 0 4px rgba(0,229,160,0.6));
  }
  .logo-icon::after {
    content:'';
    position:absolute;
    width:0; height:0;
    border-left:4px solid transparent;
    border-right:4px solid transparent;
    border-top:13px solid var(--aggressive);
    bottom:4px;
    opacity:0.55;
  }
  .logo-icon-center {
    width:4px; height:4px;
    background:var(--text);
    border-radius:50%;
    position:absolute;
    z-index:2;
  }

  .logo h1 { font-size:32px; font-weight:400; letter-spacing:2px; color:var(--text); font-family:'Bebas Neue',sans-serif; line-height:1; text-transform:uppercase; }
  .logo h1 span { background:var(--accent-gradient-text); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; font-family:'Bebas Neue',sans-serif; letter-spacing:2px; }
  .tagline { color:var(--muted); font-family:'Space Mono',monospace; font-size:11px; letter-spacing:0.3px; margin-left:0; white-space:nowrap; }
  .main-grid { display:grid; grid-template-columns:1fr; gap:24px; padding:28px 2%; position:relative; max-width:800px; margin:0 auto; }
  .panel, .strategy-card, .health-panel, .rebalance-panel { background:var(--glass-bg); border:1px solid var(--glass-border); border-radius:16px; overflow:hidden; box-shadow:var(--glass-shadow); backdrop-filter:blur(var(--glass-blur)); -webkit-backdrop-filter:blur(var(--glass-blur)); transition:transform var(--transition-med), box-shadow var(--transition-med); }
  .panel-header { padding:16px 20px 12px; border-bottom:1px solid var(--border); }
  .section-title { font-size:13px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:var(--muted); font-family:'Space Mono',monospace; }
  
  /* Stock input */
  .stock-form { padding:20px 24px; }
  .input-row { display:grid; grid-template-columns:1fr 80px; gap:8px; margin-bottom:12px; }
  input[type="text"],input[type="number"] {
    background:var(--surface2); border:1px solid var(--border); border-radius:8px;
    padding:10px 14px; color:var(--text); font-family:'Space Mono',monospace; font-size:13px;
    outline:none; transition:border-color 0.2s; width:100%;
  }
  input[type="text"]:focus,input[type="number"]:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,229,160,0.2), var(--accent-glow-subtle); background:rgba(0,229,160,0.02); }
  input::placeholder { color:var(--muted); }
  .btn-add {
    background:var(--accent); color:#000; border:none; border-radius:8px;
    padding:10px 14px; font-family:'DM Sans',sans-serif; font-weight:600; font-size:18px;
    cursor:pointer; transition:opacity var(--transition-fast),transform var(--transition-fast),box-shadow var(--transition-fast); line-height:1;
  }
  .btn-add:hover { opacity:0.85; transform:scale(1.05); box-shadow:var(--accent-glow); }
  .btn-add:active { transform:scale(0.94); box-shadow:none; }
  .error-msg { color:var(--aggressive); font-size:11px; font-family:'Space Mono',monospace; padding:4px 0 8px; }

  /* Stocks list */
  .stock-list { padding:16px 24px 12px; display:flex; flex-direction:column; gap:4px; min-height:40px; }
  .stock-item {
    display:flex; align-items:center; justify-content:space-between;
    background:var(--surface2); border:1px solid var(--border); border-radius:8px;
    padding:7px 14px; animation:slideIn 0.2s ease;
  }
  @keyframes slideIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}
  .stock-info { display:flex; align-items:center; gap:12px; }
  .stock-ticker { font-family:'DM Sans',sans-serif; font-size:15px; font-weight:700; color:var(--text); letter-spacing:0.3px; }
  .stock-company { font-size:12px; color:var(--muted); font-family:'DM Sans',sans-serif; opacity:0.7; }
  .stock-sector { font-size:10px; color:var(--muted); font-family:'DM Sans',sans-serif; letter-spacing:0.2px; }
  .stock-weight { font-family:'Space Mono',monospace; font-size:12px; color:var(--accent); font-weight:700; }
  .btn-remove { background:none; border:none; color:var(--muted); cursor:pointer; padding:0 2px; font-size:16px; transition:color 0.2s; }
  .btn-remove:hover { color:var(--aggressive); }

  /* Portfolio summary */
  .portfolio-summary { padding:16px 24px 20px; border-top:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
  .summary-chip { background:var(--surface2); border:1px solid var(--border); border-radius:6px; padding:6px 12px; font-size:11px; font-family:'Space Mono',monospace; color:var(--muted); }

  /* Analyze button */
  .btn-analyze {
    margin:0 24px 20px; padding:14px; width:calc(100% - 48px);
    background:linear-gradient(135deg,var(--accent),#00b87a); color:#000; border:none; border-radius:12px;
    font-family:'DM Sans',sans-serif; font-weight:600; font-size:13px; letter-spacing:0.5px; cursor:pointer;
    transition:opacity var(--transition-fast),transform 0.1s,box-shadow var(--transition-med);
    box-shadow:var(--accent-glow);
    position:relative; overflow:hidden;
  }
  .btn-analyze::before {
    content:''; position:absolute; top:0; left:-100%; width:60%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition:none; pointer-events:none;
  }
  .btn-analyze:hover { transform:translateY(-1px); box-shadow:var(--accent-glow-strong); }
  .btn-analyze:hover::before { left:120%; transition:left 0.6s ease; }
  .btn-analyze:active { transform:scale(0.97); box-shadow:0 2px 10px rgba(0,229,160,0.15); }
  .btn-analyze:disabled { opacity:0.4; cursor:not-allowed; box-shadow:none; }
  .btn-analyze:disabled::before { display:none; }
  .btn-analyze.analyzing { animation:analyzingPulse 1.5s ease-in-out infinite; }
  @keyframes analyzingPulse {
    0%,100% { box-shadow:0 0 20px rgba(0,229,160,0.3); }
    50% { box-shadow:0 0 40px rgba(0,229,160,0.6), 0 0 80px rgba(0,229,160,0.2); }
  }

  /* Empty state */
  .empty-state { padding:60px 24px; text-align:center; }
  .placeholder-icon { font-size:48px; margin-bottom:16px; opacity:0.3; }
  .placeholder-text { color:var(--muted); font-family:'Space Mono',monospace; font-size:13px; line-height:1.7; }

  /* Strategy card */
  .panel-body > .strategy-card { margin-bottom:12px; }
  .panel-body > .strategy-card:last-child { margin-bottom:0; }
  .strategy-card { animation:fadeUp 0.4s ease backwards; transition:transform var(--transition-med),box-shadow var(--transition-med),border-color var(--transition-med); }
  .strategy-card:hover { transform:translateY(-3px); box-shadow:var(--glass-shadow), var(--accent-glow-subtle); }
  .strategy-card:has(.badge-aggressive):hover { border-color:rgba(255,140,66,0.4); box-shadow:var(--glass-shadow), var(--aggressive-glow); }
  .strategy-card:has(.badge-moderate):hover { border-color:rgba(255,209,102,0.4); box-shadow:var(--glass-shadow), var(--moderate-glow); }
  .strategy-card:has(.badge-conservative):hover { border-color:rgba(6,214,160,0.4); box-shadow:var(--glass-shadow), var(--conservative-glow); }
  @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  .strategy-card:nth-child(2){animation-delay:0.1s}
  .strategy-card:nth-child(3){animation-delay:0.2s}
  .strategy-header {
    padding:18px 24px; display:flex; align-items:center; justify-content:space-between;
    border-bottom:1px solid var(--border);
  }
  .strategy-label { display:flex; align-items:flex-start; gap:6px; flex-wrap:wrap; max-width:65%; }
  .strategy-best-match-slot { display:block; width:100%; margin-top:-2px; }
  .strategy-badge {
    padding:4px 10px; border-radius:20px; font-size:10px; font-weight:600;
    letter-spacing:1.5px; text-transform:uppercase; font-family:'Space Mono',monospace;
  }
  .badge-aggressive { background:rgba(255,140,66,0.15); color:var(--aggressive); border:1px solid rgba(255,140,66,0.3); box-shadow:0 0 8px rgba(255,140,66,0.15); }
  .badge-moderate { background:rgba(255,209,102,0.15); color:var(--moderate); border:1px solid rgba(255,209,102,0.3); box-shadow:0 0 8px rgba(255,209,102,0.15); }
  .badge-conservative { background:rgba(6,214,160,0.15); color:var(--conservative); border:1px solid rgba(6,214,160,0.3); box-shadow:0 0 8px rgba(6,214,160,0.15); }
  .strategy-desc { font-size:12px; color:var(--muted); font-family:'Space Mono',monospace; max-width:200px; text-align:right; line-height:1.5; }
  .strategy-toggle { cursor:pointer; user-select:none; }
  .strategy-chevron { font-size:12px; color:var(--muted); transition:transform 0.25s ease; display:inline-block; }
  .strategy-chevron-open { transform:rotate(180deg); }
  .strategy-expand-hint { font-size:10px; color:var(--muted); margin-left:6px; font-weight:400; }
  .panel-toggle { cursor:pointer; user-select:none; display:flex; align-items:center; gap:0; }
  .panel-toggle .section-title { flex:1; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .panel-chevron { font-size:12px; color:var(--muted); transition:transform 0.25s ease; display:inline-block; }
  .panel-chevron-open { transform:rotate(180deg); }
  .panel-expand-hint { font-size:10px; color:var(--muted); margin-left:6px; font-weight:400; white-space:nowrap; }
  .panel-body { transition:all 0.25s ease; }
  .panel-body-collapsed { display:none; }
  .etf-list { padding:12px 16px 16px; display:flex; flex-direction:column; gap:8px; }
  .etf-list.strategy-collapsed { display:none; }

  /* ETF / Stock items */
  .etf-item {
    background:var(--surface2); border:1px solid var(--border); border-radius:10px;
    overflow:hidden; transition:border-color var(--transition-fast),box-shadow var(--transition-fast),transform var(--transition-fast); cursor:pointer;
  }
  .etf-item:hover { border-color:var(--accent); box-shadow:var(--accent-glow); transform:translateY(-1px); }
  .etf-item:active { transform:scale(0.99); }
  .etf-item.open { border-color:var(--accent); }
  .etf-item-header { padding:11px 14px; display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
  .ticker-name-group { display:flex; align-items:center; gap:10px; }
  .ticker-with-tag { display:flex; flex-direction:column; align-items:flex-start; gap:3px; min-width:60px; }
  .etf-ticker, .pick-ticker { font-family:'Space Mono',monospace; font-size:14px; font-weight:700; color:var(--text); }
    .item-type-tag { font-family:'Space Mono',monospace; font-size:8px; font-weight:700; letter-spacing:1px; padding:1px 5px; border-radius:3px; }
  .tag-etf { background:rgba(77,159,255,0.15); color:#4d9fff; border:1px solid rgba(77,159,255,0.3); }
  .tag-stock { background:rgba(255,140,66,0.12); color:var(--aggressive); border:1px solid rgba(255,140,66,0.25); }
  .etf-details h4, .pick-details h4 { font-size:13px; font-weight:600; color:var(--text); margin-bottom:2px; }
  .etf-details p,.pick-details p { font-size:12px; color:var(--muted); font-family:'Space Mono',monospace; }
    .etf-meta,.pick-meta { text-align:right; display:flex; flex-direction:column; align-items:flex-end; gap:4px; }
    .match-score { font-family:'Space Mono',monospace; font-size:11px; padding:2px 8px; border-radius:4px; font-weight:700; }
  .match-high { background:rgba(0,229,160,0.15); color:var(--accent); box-shadow:0 0 6px rgba(0,229,160,0.2); }
  .match-med { background:rgba(255,209,102,0.15); color:var(--moderate); box-shadow:0 0 6px rgba(255,209,102,0.15); }
  .pick-sector-tag { font-family:'Space Mono',monospace; font-size:10px; padding:2px 7px; border-radius:4px; display:inline-block; }
  .etf-meta .pick-sector-tag { background:rgba(77,159,255,0.15); color:#4d9fff; border:1px solid rgba(77,159,255,0.3); }
  .pick-meta .pick-sector-tag { background:rgba(255,140,66,0.1); color:var(--aggressive); border:1px solid rgba(255,140,66,0.25); }
  .pick-risk { font-family:'Space Mono',monospace; font-size:12px; font-weight:700; }
  
  /* Why hint */
  .etf-hint, .pick-hint {
    padding:0 14px 9px; font-family:'Space Mono',monospace; font-size:10px;
    color:var(--accent); opacity:0.55; letter-spacing:0.5px;
    display:flex; align-items:center; gap:5px; transition:opacity 0.2s;
  }
  .etf-item:hover .etf-hint, .etf-item:hover .pick-hint { opacity:1; }
  .etf-item.open .etf-hint, .etf-item.open .pick-hint { display:none; }

  /* Drawer */
  .etf-drawer,.pick-drawer { max-height:0; overflow:hidden; transition:max-height 0.35s cubic-bezier(0.4,0,0.2,1); }
  .etf-item.open .etf-drawer,.etf-item.open .pick-drawer { max-height:300px; }
  .etf-drawer-inner,.pick-drawer-inner {
    margin:0 12px 12px; background:rgba(0,229,160,0.05);
    border:1px solid rgba(0,229,160,0.15); border-radius:8px; padding:12px 14px;
  }
  .pick-drawer-inner { background:rgba(255,140,66,0.05); border-color:rgba(255,140,66,0.15); }
  .etf-drawer-label,.pick-drawer-label {
    font-family:'Space Mono',monospace; font-size:10px; font-weight:700;
    color:var(--accent); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:7px;
  }
  .pick-drawer-label { color:var(--aggressive); }
  .etf-drawer-text,.pick-drawer-text { font-family:'Space Mono',monospace; font-size:12px; color:var(--text); line-height:1.7; opacity:0.85; }
  .etf-drawer-loading { display:flex; align-items:center; gap:8px; font-family:'Space Mono',monospace; font-size:11px; color:var(--muted); }
  .mini-spinner { width:12px; height:12px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 0.7s linear infinite; flex-shrink:0; }
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Analysis bar */
  .analysis-bar { background:var(--glass-bg); border:1px solid var(--glass-border); border-radius:16px; padding:20px 24px 16px; animation:fadeUp 0.3s ease; backdrop-filter:blur(var(--glass-blur)); -webkit-backdrop-filter:blur(var(--glass-blur)); box-shadow:var(--glass-shadow); }
  .analysis-bar-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; flex-wrap:wrap; gap:10px; }
  .analysis-bar-header h2 { margin:0; }
  .breakdown-legend { display:flex; gap:8px; align-items:center; flex-wrap:nowrap; overflow-x:auto; }
  .legend-item { display:flex; align-items:center; gap:5px; font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); text-transform:uppercase; letter-spacing:0.5px; }
  .legend-hint { font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); opacity:0.45; font-style:italic; margin-left:2px; }
  .legend-dot { width:10px; height:6px; border-radius:2px; flex-shrink:0; }
  .legend-dot-current { background:#64748b; }
  .legend-tick { width:2px; height:12px; border-radius:1px; flex-shrink:0; }
  .legend-tick-agg { background:var(--aggressive); }
  .legend-tick-mod { background:var(--moderate); }
  .legend-tick-con { background:var(--conservative); }

  /* Hoverable legend */
  .legend-item.hoverable {
    cursor:pointer; padding:3px 7px; border-radius:6px;
    border:1px solid transparent; transition:background 0.15s,border-color 0.15s,color 0.15s;
    position:relative;
  }
  .legend-item.hoverable:hover,.legend-item.hoverable.active { background:rgba(255,255,255,0.05); border-color:var(--border); }
  .legend-item.hoverable.active-agg { color:var(--aggressive); border-color:rgba(255,140,66,0.3); background:rgba(255,140,66,0.08); }
  .legend-item.hoverable.active-mod { color:var(--moderate); border-color:rgba(255,209,102,0.3); background:rgba(255,209,102,0.08); }
  .legend-item.hoverable.active-con { color:var(--conservative); border-color:rgba(6,214,160,0.3); background:rgba(6,214,160,0.08); }

  /* Strategy tooltips */
  .strategy-tooltip {
    position:absolute; bottom:calc(100% + 10px); left:50%;
    transform:translateX(-50%) translateY(4px);
    width:220px; background:rgba(26,31,46,0.85); border:1px solid var(--glass-border);
    border-radius:10px; padding:12px 14px; pointer-events:none;
    opacity:0; transition:opacity 0.18s ease,transform 0.18s ease;
    z-index:100; box-shadow:0 8px 32px rgba(0,0,0,0.5);
    backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
  }
  .legend-item.hoverable:hover .strategy-tooltip,
  .legend-item.hoverable.active .strategy-tooltip { opacity:1; transform:translateX(-50%) translateY(0); }
  .strategy-tooltip::after {
    content:''; position:absolute; top:100%; left:50%; transform:translateX(-50%);
    border:5px solid transparent; border-top-color:var(--border);
  }
  .tooltip-label { font-family:'Space Mono',monospace; font-size:9px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; margin-bottom:6px; }
  .tooltip-label.agg { color:var(--aggressive); }
  .tooltip-label.mod { color:var(--moderate); }
  .tooltip-label.con { color:var(--conservative); }
  .tooltip-body { font-family:'Space Mono',monospace; font-size:11px; color:var(--text); line-height:1.65; opacity:0.8; }
  .tooltip-note { margin-top:8px; padding-top:8px; border-top:1px solid var(--border); font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); font-style:italic; line-height:1.5; }

  /* Sector bars */
  .sector-bars { display:flex; flex-direction:column; gap:7px; }
  .sector-row { display:grid; grid-template-columns:140px 1fr 32px; align-items:center; gap:10px; }
  .sector-name { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .sector-pct { font-family:'Space Mono',monospace; font-size:10px; color:var(--text); text-align:right; font-weight:700; }
  .sector-row.missing .sector-name { opacity:0.45; }
  .sector-row.missing .sector-pct { color:var(--muted); font-weight:400; }
  .sector-bar-track { position:relative; background:var(--surface2); height:8px; border-radius:4px; overflow:visible; }
  .sector-bar-track.empty { background:rgba(255,255,255,0.04); border:1px dashed rgba(255,255,255,0.08); }
  .sector-bar-fill { height:100%; border-radius:4px; transition:width 0.9s cubic-bezier(0.4,0,0.2,1); position:relative; z-index:1; }
  /* Target tick markers — vertical line at target % position */
  .sector-tick { position:absolute; top:-3px; width:3px; height:14px; border-radius:2px; opacity:0; transition:opacity 0.25s ease, left 0.9s cubic-bezier(0.4,0,0.2,1); pointer-events:none; z-index:3; transform:translateX(-50%); }
  .sector-tick.agg { background:var(--aggressive); box-shadow:0 0 6px rgba(255,140,66,0.8); }
  .sector-tick.mod { background:var(--moderate); box-shadow:0 0 6px rgba(255,209,102,0.8); }
  .sector-tick.con { background:var(--conservative); box-shadow:0 0 6px rgba(6,214,160,0.8); }
  .sector-bars.show-agg .sector-tick.agg { opacity:1; }
  .sector-bars.show-mod .sector-tick.mod { opacity:1; }
  .sector-bars.show-con .sector-tick.con { opacity:1; }
  .sector-divider { display:flex; align-items:center; gap:8px; margin:14px 0 10px; }
  .sector-divider::before,.sector-divider::after { content:''; flex:1; height:1px; background:var(--border); }
  .sector-divider span { font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); letter-spacing:1.5px; text-transform:uppercase; white-space:nowrap; }

  /* Screenshot upload */
  .upload-zone {
    margin:0 24px 16px; border:1.5px dashed var(--border); border-radius:12px;
    padding:18px 16px; text-align:center; cursor:pointer;
    transition:border-color 0.2s,background 0.2s; position:relative; overflow:hidden;
  }
  .upload-zone:hover,.upload-zone.drag-over { border-color:var(--accent); background:rgba(0,229,160,0.04); box-shadow:var(--accent-glow-subtle), 0 0 20px rgba(0,229,160,0.06) inset; }
  .upload-zone input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
  .upload-icon { font-size:20px; margin-bottom:6px; opacity:0.5; }
  .upload-text { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); line-height:1.6; }
  .upload-text strong { color:var(--accent); }
  .scanning-overlay {
    position:absolute; inset:0; background:rgba(10,12,16,0.9); display:flex;
    flex-direction:column; align-items:center; justify-content:center; gap:10px;
    opacity:0; pointer-events:none; transition:opacity 0.2s; border-radius:10px;
  }
  .scanning-overlay.active { opacity:1; pointer-events:all; }
  .scan-spinner { width:24px; height:24px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 0.7s linear infinite; }
  .scan-text { font-family:'Space Mono',monospace; font-size:10px; color:var(--accent); letter-spacing:1px; }
  .import-preview { display:none; margin:0 24px 16px; }
  .import-preview.visible { display:block; }
  .import-preview-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
  .import-note { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); }
  .btn-import-all {
    background:var(--accent); color:#000; border:none; border-radius:6px;
    padding:6px 14px; font-family:'Space Mono',monospace; font-size:11px; font-weight:700;
    cursor:pointer; transition:opacity 0.15s;
  }
  .btn-import-all:hover { opacity:0.85; }
  .preview-items { display:flex; flex-direction:column; gap:5px; max-height:160px; overflow-y:auto; }
  .preview-item { display:grid; grid-template-columns:52px 1fr 70px 20px; align-items:center; gap:8px; background:var(--surface2); border-radius:6px; padding:7px 10px; }
  .preview-ticker { font-family:'Space Mono',monospace; font-size:12px; font-weight:700; color:var(--accent); }
  .preview-name { font-size:11px; color:var(--muted); font-family:'Space Mono',monospace; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .preview-pct-wrapper { display:flex; align-items:center; gap:2px; }
  .preview-pct-input { background:var(--surface); border:1px solid var(--border); border-radius:4px; padding:3px 4px; font-family:'Space Mono',monospace; font-size:12px; color:var(--text); width:48px; outline:none; text-align:right; }
  .preview-pct-input:focus { border-color:var(--accent); }
  .preview-pct-symbol { font-family:'Space Mono',monospace; font-size:11px; color:var(--muted); }
  .btn-preview-remove { background:none; border:none; color:var(--muted); cursor:pointer; font-size:14px; padding:0; transition:color 0.15s; }
  .btn-preview-remove:hover { color:var(--aggressive); }

  /* Results panel */
  .results-panel { display:flex; flex-direction:column; gap:20px; }

  /* ── PORTFOLIO HEALTH PANEL ─── */
  .health-alert { display:flex; align-items:center; gap:10px; padding:12px 20px; background:rgba(255,209,102,0.06); border-bottom:1px solid var(--border); font-family:'Space Mono',monospace; font-size:12px; color:var(--moderate); }
  .health-cards { display:grid; grid-template-columns:1fr 1fr; gap:0; }
  .health-card { padding:20px 24px; text-align:center; }
  .health-card:first-child { border-right:1px solid var(--border); }
  .health-card-label { font-family:'Space Mono',monospace; font-size:10px; letter-spacing:1px; text-transform:uppercase; color:var(--muted); margin-bottom:8px; }
  .health-card-value { font-family:'DM Sans',sans-serif; font-size:26px; font-weight:700; color:var(--text); }
  .health-card-value.moderate { color:var(--moderate); }
  .health-card-value.conservative { color:var(--conservative); }
  .health-card-value.aggressive { color:var(--aggressive); }
  .health-card-sub { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); margin-top:4px; }
  .health-card-bar { width:60px; height:4px; border-radius:2px; background:var(--border); margin:8px auto 0; }
  .health-card-bar-fill { height:100%; border-radius:2px; }
  .health-compare { padding:16px 20px; border-top:1px solid var(--border); }
  .health-compare-title { font-family:'Space Mono',monospace; font-size:10px; letter-spacing:1px; text-transform:uppercase; color:var(--muted); margin-bottom:12px; }
  .health-compare-row { display:grid; grid-template-columns:140px 1fr 100px 60px; align-items:center; gap:10px; padding:8px 0; border-bottom:1px solid rgba(30,36,48,0.5); font-family:'Space Mono',monospace; font-size:12px; }
  .health-compare-row:last-child { border-bottom:none; }
  .health-compare-label { color:var(--muted); }
  .health-compare-val { color:var(--text); font-weight:700; text-align:center; }
  .health-compare-spy { color:var(--muted); font-size:10px; text-align:center; }
  .health-compare-diff { font-size:10px; font-weight:700; text-align:right; }
  .health-compare-diff.good { color:var(--conservative); }
  .health-compare-diff.warn { color:var(--moderate); }
  .health-compare-diff.bad { color:var(--aggressive); }

  /* ── REBALANCING SUGGESTIONS ─── */
  .rebalance-list { padding:12px 20px 16px; display:flex; flex-direction:column; gap:8px; }
  .rebalance-item { font-family:'Space Mono',monospace; font-size:13px; color:var(--text); display:flex; align-items:center; gap:8px; }
  .rebalance-item .sector-link { color:var(--accent); cursor:default; }
  .rebalance-item .rebalance-note { color:var(--muted); font-size:12px; }


  /* Live market data badges */
  .market-inline { display:inline-flex; align-items:center; gap:5px; vertical-align:middle; margin-left:6px; }
  .market-inline-price { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); font-weight:400; }
  .market-inline-price .currency { font-family:'DM Sans',sans-serif; font-size:9px; font-weight:700; color:var(--text); vertical-align:0.5px; margin-right:1px; }
  .market-badge {
    display:inline-flex; align-items:center; gap:3px;
    font-family:'Space Mono',monospace; font-size:9px; font-weight:700;
    padding:1px 5px; border-radius:3px; white-space:nowrap; flex-shrink:0;
  }
  .market-badge.up      { background:rgba(0,229,160,0.12); color:var(--conservative); border:1px solid rgba(0,229,160,0.25); box-shadow:0 0 6px rgba(0,229,160,0.12); }
  .market-badge.down    { background:rgba(255,140,66,0.12); color:var(--aggressive);   border:1px solid rgba(255,140,66,0.25); box-shadow:0 0 6px rgba(255,140,66,0.12); }
  .market-badge.flat    { background:rgba(90,100,120,0.15); color:var(--muted);        border:1px solid var(--border); }
  .market-badge.loading { background:var(--surface2); color:var(--muted); border:1px solid var(--border); animation:pulse 1.4s ease infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  @keyframes fadeIn { from{opacity:0} to{opacity:1} }
  @keyframes slideUp { from{transform:translateY(16px);opacity:0} to{transform:translateY(0);opacity:1} }

  /* ── SHOW MORE ─── */
  .show-more-items { display:none; flex-direction:column; gap:8px; }
  .show-more-items.open { display:flex; }
  .show-more-hidden { display:none !important; }
  .btn-show-more {
    margin:6px 0 2px; width:100%;
    background:none; border:1px dashed var(--border); border-radius:8px;
    padding:9px 14px; cursor:pointer; transition:border-color 0.2s, color 0.2s;
    display:flex; align-items:center; justify-content:center; gap:6px;
    font-family:'Space Mono',monospace; font-size:10px; letter-spacing:0.5px;
    color:var(--muted);
  }
  .btn-show-more:hover { border-color:var(--accent); color:var(--accent); }
  .btn-show-more.open  { border-style:solid; border-color:var(--border); color:var(--muted); }
  .market-close-label { font-family:'Space Mono',monospace; font-size:8px; color:var(--muted); opacity:0.6; letter-spacing:0.3px; }
  .market-refresh-row {
    display:flex; align-items:center; justify-content:space-between;
    padding:8px 0 4px; margin:0 0 8px;
  }
  .market-status { font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); }
  .market-status.live  { color:var(--conservative); }
  .market-status.error { color:var(--aggressive); }
  .btn-refresh-market {
    background:none; border:1px solid var(--border); border-radius:6px;
    padding:4px 10px; font-family:'Space Mono',monospace; font-size:9px;
    color:var(--muted); cursor:pointer; transition:border-color 0.2s,color 0.2s;
    display:flex; align-items:center; gap:5px;
  }
  .btn-refresh-market:hover { border-color:var(--accent); color:var(--text); }
  .btn-refresh-market.spinning svg { animation:spin 0.7s linear infinite; }

  /* Disclaimer */
  .disclaimer-footer {
    text-align:center; font-family:'Space Mono',monospace; font-size:10px;
    color:var(--muted); opacity:0.5; padding:12px 8px 4px;
    line-height:1.6; border-top:1px solid var(--border); margin-top:4px;
  }

  /* ── RESPONSIVE ─────────────────────────────────────────── */

  /* Large desktop (1400px+) */
  @media (min-width: 1400px) {
    .main-grid { gap: 32px; padding: 36px 2%; }
    .panel-header { padding: 20px 28px 14px; }
    .stock-form { padding: 24px 28px; }
    .stock-list { padding: 16px 28px 14px; }
    .portfolio-summary { padding: 18px 28px 22px; }
    .btn-analyze { margin: 0 28px 24px; width: calc(100% - 56px); padding: 16px; font-size: 14px; }
    .upload-zone { margin: 0 28px 18px; }
    .import-preview { margin: 0 28px 18px; }
    .strategy-header { padding: 20px 28px; }
    .etf-list { padding: 14px 20px 20px; }
    .analysis-bar { padding: 24px 28px 20px; }
    .sector-row { grid-template-columns: 160px 1fr 36px; }
  }

  /* Medium-large desktop (1100–1400px) */
  @media (min-width: 1100px) and (max-width: 1399px) {
    .main-grid { gap: 28px; padding: 32px 2%; }
    .sector-row { grid-template-columns: 150px 1fr 34px; }
  }

  /* Small desktop / large tablet (900–1100px) */
  @media (min-width: 901px) and (max-width: 1099px) {
    .main-grid { gap: 20px; padding: 24px 2%; }
    .sector-row { grid-template-columns: 120px 1fr 32px; }
    .strategy-desc { max-width: 150px; font-size: 10px; }
  }

  /* Sticky analyze button (all screen sizes) */
  .btn-analyze-sticky {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 900;
    background: var(--accent);
    color: #000;
    border: none;
    padding: 16px;
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 0.5px;
    cursor: pointer;
    display: none;
    text-align: center;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
    padding-bottom: calc(16px + env(safe-area-inset-bottom));
  }
  .btn-analyze-sticky.visible { display: block; }
  .btn-analyze-sticky:active { opacity: 0.85; }

  /* Tablet (max 900px) */
  @media (max-width: 900px) {
    .main-grid {
      grid-template-columns: 1fr;
      padding: 20px 16px;
      gap: 20px;
    }
    .container { padding: 0 16px; }
    header {
      padding: 20px 20px 16px;
      flex-direction: row; flex-wrap: wrap; align-items: center;
    }
    header.header-compact { padding: 10px 20px 10px; }
    .logo { flex: 1; min-width: 0; }
    .tagline { font-size:9px; opacity:0.5; }
    .header-actions {
      position: static; transform: none;
      order: 0;
    }
    .user-pill { font-size:11px; padding:3px 10px 3px 8px; }
    .sector-row { grid-template-columns: 110px 1fr 32px; }
    .strategy-desc { max-width: 160px; }
    /* (sticky analyze button moved to global scope) */
    body { padding-bottom: 56px; }
  }

  /* Mobile (max 600px) */
  @media (max-width: 600px) {
    header {
      padding: 14px 16px 12px;
      gap: 6px;
    }
    header.header-compact { padding: 8px 16px 8px; }
    header.header-compact .logo h1 { font-size: 15px; }
    header.header-compact .logo-icon { width: 24px; height: 24px; }
    .logo h1 { font-size: 17px; }
    .logo-icon { width: 30px; height: 30px; }
    .tagline { font-size:8px; opacity:0.4; }
    .header-actions { gap: 6px; }
    .user-pill { font-size:10px; padding:3px 8px 3px 7px; }
    .user-pill-avatar { width:18px; height:18px; }
    .sidebar { width:100%; right:-100%; }
    .theme-toggle {
      padding: 4px 4px 4px 8px;
      font-size: 9px;
    }
    .theme-toggle-track { width: 24px; height: 14px; }
    .theme-toggle-thumb { width: 10px; height: 10px; }
    body.light .theme-toggle-thumb { transform: translateX(10px); }

    .main-grid { padding: calc(8px + env(safe-area-inset-top, 0px)) 12px 14px; gap: 16px; }
    .container { padding: 0 12px; }

    .panel-header { padding: 12px 16px 10px; }
    .section-title { font-size: 11px; letter-spacing: 1.2px; }

    .stock-form { padding: 14px 16px; }
    .input-row { grid-template-columns: 1fr 70px; gap: 6px; margin-bottom: 10px; }
    input[type="text"], input[type="number"] { padding: 9px 10px; font-size: 12px; }
    .btn-add { padding: 9px 12px; font-size: 16px; }

    .stock-list { padding: 16px 16px 10px; gap: 3px; }
    .stock-item { padding: 6px 12px 4px; }
    .stock-info { gap: 8px; }
    .stock-ticker { font-size: 14px; }
    .stock-company { font-size: 11px; }
    .stock-sector { font-size: 9px; }

    .portfolio-summary { padding: 12px 16px 14px; }
    .btn-analyze { margin: 0 16px 16px; width: calc(100% - 32px); padding: 13px; font-size: 12px; }

    .upload-compact-trigger { margin: 0 16px 10px; padding: 9px 12px; font-size: 10px; }
    .upload-zone { margin: 0 16px 14px; padding: 14px 12px; }
    .upload-text { font-size: 9px; }
    .holdings-grid { padding: 10px 16px; }
    .holdings-view-toggle { padding: 10px 16px 6px; }
    .import-preview { margin: 0 16px 14px; }
    .preview-item { grid-template-columns: 44px 1fr 60px 18px; gap: 6px; padding: 6px 8px; }
    .preview-ticker { font-size: 11px; }
    .preview-name { font-size: 10px; }
    .preview-pct-input { width: 40px; font-size: 11px; }

    /* Analysis bar */
    .analysis-bar { padding: 14px 16px 12px; }
    .analysis-bar-header { flex-direction: column; align-items: flex-start; gap: 8px; margin-bottom: 12px; }
    .breakdown-legend { gap: 6px; }
    .sector-row { grid-template-columns: 90px 1fr 28px; gap: 8px; }
    .sector-name { font-size: 9px; }
    .sector-pct { font-size: 9px; }

    /* Strategy cards */
    .strategy-header { padding: 14px 16px; flex-wrap: wrap; gap: 8px; }
    .strategy-desc { max-width: 100%; text-align: left; font-size: 10px; }
    .etf-list { padding: 10px 12px 14px; gap: 6px; }
    .etf-item-header { padding: 10px 12px; }
    .etf-ticker, .pick-ticker { font-size: 13px; }
    .etf-details h4, .pick-details h4 { font-size: 11px; }
    .etf-details p, .pick-details p { font-size: 10px; }

    /* Strategy tooltip: reposition on mobile */
    .strategy-tooltip {
      left: auto;
      right: 0;
      transform: translateY(4px);
      width: 190px;
    }
    .legend-item.hoverable:hover .strategy-tooltip,
    .legend-item.hoverable.active .strategy-tooltip {
      transform: translateY(0);
    }

    /* Drawer text */
    .etf-drawer-inner, .pick-drawer-inner { padding: 10px 12px; margin: 0 10px 10px; }
    .etf-drawer-text, .pick-drawer-text { font-size: 10px; }

    /* Empty state */
    .empty-state { padding: 40px 16px; }
    .placeholder-icon { font-size: 36px; }
    .placeholder-text { font-size: 11px; }

    /* Disclaimer */
    .disclaimer-footer { font-size: 9px; padding: 10px 4px 4px; }
  }

  /* Very small screens */
  @media (max-width: 360px) {
    .logo h1 { font-size: 15px; }
    .sector-row { grid-template-columns: 78px 1fr 26px; }
    .input-row { grid-template-columns: 1fr 60px; }
  }

  @media (min-width: 901px) {
    .btn-analyze-sticky { display: none !important; }
  }

  /* ── SIDEBAR ─── */
  .sidebar-backdrop {
    position:fixed; inset:0; background:rgba(0,0,0,0.5);
    z-index:20000; opacity:0; pointer-events:none;
    transition:opacity 0.3s ease;
  }
  .sidebar-backdrop.open { opacity:1; pointer-events:auto; }
  .sidebar {
    position:fixed; top:0; right:-320px; bottom:0; width:300px;
    background:var(--glass-bg); border-left:1px solid var(--glass-border);
    backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
    box-shadow:-8px 0 40px rgba(0,0,0,0.4);
    z-index:20001; overflow-y:auto;
    transition:right 0.3s ease;
    display:flex; flex-direction:column;
  }
  .sidebar.open { right:0; }
  .sidebar-header {
    display:flex; justify-content:flex-end; padding:16px 16px 0;
  }
  .sidebar-close {
    background:none; border:none; color:var(--muted); font-size:18px;
    cursor:pointer; padding:4px 8px; border-radius:6px;
    transition:color 0.15s, background 0.15s;
  }
  .sidebar-close:hover { color:var(--text); background:var(--surface2); }
  .sidebar-user {
    padding:8px 20px 16px; border-bottom:1px solid var(--border);
  }
  .sidebar-user-info {
    display:flex; align-items:center; gap:12px;
  }
  .sidebar-user-avatar {
    width:40px; height:40px; border-radius:50%; border:2px solid var(--accent);
    flex-shrink:0; object-fit:cover;
  }
  .sidebar-user-avatar.initials {
    display:flex; align-items:center; justify-content:center;
    background:var(--surface2); color:var(--accent);
    font-size:16px; font-weight:700; font-family:'DM Sans',sans-serif;
  }
  .sidebar-user-details { min-width:0; }
  .sidebar-user-name {
    font-family:'DM Sans',sans-serif; font-size:14px; font-weight:600;
    color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .sidebar-user-email {
    font-family:'Space Mono',monospace; font-size:10px; color:var(--muted);
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .sidebar-pro-badge {
    display:inline-block; margin-top:6px;
    font-family:'Space Mono',monospace; font-size:10px; color:#00e5a0;
    background:rgba(0,229,160,0.1); border:1px solid rgba(0,229,160,0.25);
    border-radius:6px; padding:3px 8px;
    animation:proGlow 2s ease-in-out infinite;
  }
  @keyframes proGlow {
    0%,100% { box-shadow:0 0 6px rgba(0,229,160,0.2); }
    50% { box-shadow:0 0 14px rgba(0,229,160,0.4); }
  }
  .sidebar-signin-btn {
    width:100%; margin-top:8px; padding:10px; border-radius:8px;
    border:1px solid var(--border); background:var(--surface2);
    color:var(--text); font-family:'DM Sans',sans-serif; font-size:13px;
    font-weight:600; cursor:pointer; transition:border-color 0.2s;
    display:flex; align-items:center; justify-content:center; gap:6px;
  }
  .sidebar-signin-btn:hover { border-color:var(--accent); }
  .sidebar-section {
    padding:12px 20px; border-bottom:1px solid var(--border);
  }
  .sidebar-section:empty { display:none; }
  .sidebar-section-title {
    font-family:'Space Mono',monospace; font-size:9px; font-weight:700;
    color:var(--muted); letter-spacing:1.5px; text-transform:uppercase;
    margin-bottom:8px;
  }
  .sidebar-portfolios {
    display:flex; flex-direction:column; gap:4px; margin-bottom:6px;
  }
  .sidebar-slot {
    display:flex; align-items:center; gap:6px;
    background:var(--surface2); border:1px solid var(--border);
    border-radius:8px; padding:7px 10px; cursor:pointer;
    transition:border-color 0.2s; position:relative;
  }
  .sidebar-slot:hover { border-color:var(--accent); }
  .sidebar-slot.active { border-color:var(--accent); background:rgba(0,229,160,0.06); }
  .sidebar-slot.active::before {
    content:'✓'; position:absolute; left:-2px; top:50%; transform:translate(-50%, -50%);
    background:var(--accent); color:#000; width:14px; height:14px; border-radius:50%;
    font-size:9px; display:flex; align-items:center; justify-content:center; font-weight:700;
  }
  .sidebar-empty {
    padding:10px; text-align:center;
    font-family:'Space Mono',monospace; font-size:10px; color:var(--muted);
  }
  .sidebar-portfolio-actions {
    display:flex; flex-direction:column; gap:4px;
  }
  .sidebar-btn {
    width:100%; background:var(--surface2); border:1px solid var(--border); border-radius:7px;
    padding:7px 10px; font-family:'Space Mono',monospace; font-size:10px; color:var(--muted);
    cursor:pointer; transition:border-color 0.2s, color 0.2s; text-align:left;
  }
  .sidebar-btn:hover { border-color:var(--accent); color:var(--text); }
  .sidebar-btn-danger { border-color:transparent; }
  .sidebar-btn-danger:hover { border-color:var(--aggressive) !important; color:var(--aggressive) !important; }
  .sidebar-nav-links { display:flex; flex-direction:column; gap:2px; }
  .sidebar-nav-btn {
    width:100%; background:transparent; border:1px solid transparent; border-radius:8px;
    padding:10px 12px; font-family:'DM Sans',sans-serif; font-size:13px; color:var(--text);
    cursor:pointer; transition:background 0.2s, border-color 0.2s; text-align:left;
    display:flex; align-items:center; gap:10px;
  }
  .sidebar-nav-btn:hover { background:var(--surface2); border-color:var(--border); }
  .sidebar-nav-icon { color:var(--accent); font-size:10px; width:16px; text-align:center; }
  .sidebar-settings-row {
    display:flex; align-items:center; justify-content:space-between;
    padding:6px 0;
  }
  .sidebar-settings-label {
    font-family:'Space Mono',monospace; font-size:11px; color:var(--text);
    display:flex; align-items:center; gap:6px;
  }
  .sidebar-account-btn {
    display:block; width:100%; text-align:left; padding:8px 0; background:none; border:none;
    font-family:'Space Mono',monospace; font-size:11px; cursor:pointer;
    transition:color 0.15s;
  }
  .sidebar-account-btn.sign-out { color:var(--aggressive); }
  .sidebar-account-btn.sign-out:hover { color:#ff6b82; }
  .sidebar-account-btn.delete-account { color:var(--muted); font-size:10px; opacity:0.6; }
  .sidebar-account-btn.delete-account:hover { color:var(--aggressive); opacity:1; }
  .sidebar-footer {
    margin-top:auto; padding:16px 20px;
    font-family:'Space Mono',monospace; font-size:9px; color:var(--muted);
    text-align:center;
  }
  .sidebar-footer a { color:var(--muted); text-decoration:none; }
  .sidebar-footer a:hover { color:var(--text); }
  .slot-name { font-family:'Space Mono',monospace; font-size:11px; color:var(--text); flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .slot-name-input {
    font-family:'Space Mono',monospace; font-size:11px; color:var(--text);
    background:none; border:none; outline:none; flex:1; cursor:text;
  }
  .slot-count { font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); }
  .slot-actions { display:flex; gap:4px; }
  .slot-btn {
    background:none; border:none; color:var(--muted); cursor:pointer;
    font-size:16px; padding:3px 6px; border-radius:4px; transition:color 0.15s, background 0.15s;
    line-height:1;
  }
  .slot-btn:hover { color:var(--accent); background:var(--border); }
  .slot-btn.danger:hover { color:var(--aggressive); background:var(--border); }

  /* Ticker autocomplete */
  .autocomplete-wrapper { position:relative; }
  .autocomplete-dropdown {
    display:none; position:absolute; top:100%; left:0; right:0; z-index:100;
    background:var(--glass-bg); border:1px solid var(--glass-border); border-top:none;
    border-radius:0 0 8px 8px; max-height:200px; overflow-y:auto;
    box-shadow:0 8px 32px rgba(0,0,0,0.5);
    backdrop-filter:blur(var(--glass-blur)); -webkit-backdrop-filter:blur(var(--glass-blur));
  }
  .autocomplete-dropdown.open { display:block; }
  .autocomplete-item {
    padding:8px 12px; cursor:pointer; display:flex; justify-content:space-between;
    align-items:center; font-family:'Space Mono',monospace; font-size:11px;
    border-bottom:1px solid var(--border);
  }
  .autocomplete-item:last-child { border-bottom:none; }
  .autocomplete-item:hover, .autocomplete-item.selected { background:var(--surface2); }
  .autocomplete-item-ticker { color:var(--accent); font-weight:700; }
  .autocomplete-item-name { color:var(--muted); font-size:10px; text-align:right; max-width:60%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

  /* ── RISK SCORE ─── */
  .risk-score-bar {
    margin: 0 24px 14px;
    background: var(--glass-bg); border: 1px solid var(--glass-border);
    border-radius: 10px; padding: 10px 14px;
    display: flex; align-items: center; gap: 12px;
    backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  }
  .risk-score-label { font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; white-space:nowrap; }
  .risk-score-track { flex:1; height:6px; background:var(--border); border-radius:3px; overflow:hidden; }
  .risk-score-fill { height:100%; border-radius:3px; transition:width 0.6s cubic-bezier(0.4,0,0.2,1), background 0.6s; }
  .risk-score-num { font-family:'Space Mono',monospace; font-size:13px; font-weight:700; min-width:28px; text-align:right; }

  /* ── CORRELATION WARNINGS ─── */
  .correlation-warnings {
    margin: 0 24px 10px; display: flex; flex-direction: column; gap: 5px;
  }
  .corr-warn {
    display: flex; align-items: flex-start; gap: 7px;
    background: rgba(255,209,102,0.07); border: 1px solid rgba(255,209,102,0.2);
    border-radius: 7px; padding: 7px 10px; animation: slideIn 0.2s ease;
  }
  .corr-icon { font-size:11px; flex-shrink:0; margin-top:1px; }
  .corr-text { font-family:'Space Mono',monospace; font-size:10px; color:var(--moderate); line-height:1.5; }
  .corr-text strong { color:var(--text); }

  /* ── SLIDER on holdings ─── */
  .stock-item { flex-direction: column; align-items: stretch; gap: 3px; padding: 7px 14px 5px; }
  .stock-item-top { display:flex; align-items:center; justify-content:space-between; }
  .stock-slider-row { display:flex; align-items:center; gap:8px; }
  .stock-slider {
    flex:1; -webkit-appearance:none; appearance:none;
    height:3px; border-radius:2px; background:var(--border); outline:none; cursor:pointer;
  }
  .stock-slider::-webkit-slider-thumb {
    -webkit-appearance:none; appearance:none;
    width:12px; height:12px; border-radius:50%;
    background:var(--accent); cursor:pointer;
    box-shadow: 0 0 8px rgba(0,229,160,0.6), 0 0 16px rgba(0,229,160,0.2);
    transition: transform 0.1s, box-shadow 0.15s;
  }
  .stock-slider::-webkit-slider-thumb:hover { transform: scale(1.3); box-shadow: 0 0 12px rgba(0,229,160,0.8), 0 0 24px rgba(0,229,160,0.3); }
  .stock-slider::-moz-range-thumb {
    width:12px; height:12px; border-radius:50%;
    background:var(--accent); cursor:pointer; border:none;
  }
  .slider-pct { font-family:'Space Mono',monospace; font-size:11px; color:var(--accent); font-weight:700; min-width:36px; text-align:right; }

  /* ── WHAT-IF SIMULATOR ─── */
  .whatif-panel {
    margin: 0 24px 14px; background:var(--surface2);
    border:1px solid var(--border); border-radius:10px;
  }
  .whatif-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:9px 14px; cursor:pointer; transition:background 0.15s;
  }
  .whatif-header:hover { background:rgba(255,255,255,0.03); }
  .whatif-title { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; }
  .whatif-toggle { font-size:10px; color:var(--muted); }
  .whatif-body { padding:0 14px 16px; display:none; }
  .whatif-body.open { display:block; }
  .whatif-row { display:grid; grid-template-columns:1fr 70px; gap:6px; margin-bottom:8px; }
  .whatif-result { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); line-height:1.6; }
  .whatif-result strong { color:var(--accent); }
  .whatif-result .wi-new { color:var(--moderate); }
  .btn-whatif-add { margin-top:8px; background:rgba(0,229,160,0.1); border:1px solid rgba(0,229,160,0.3); border-radius:6px; padding:6px 12px; font-family:'Space Mono',monospace; font-size:10px; font-weight:600; color:var(--accent); cursor:pointer; transition:background 0.15s; }
  .btn-whatif-add:hover { background:rgba(0,229,160,0.2); }

  /* ── ONBOARDING ─── */
  .onboarding-banner {
    margin: 16px 24px 14px; background: rgba(0,229,160,0.05);
    border:1px solid rgba(0,229,160,0.15); border-left:3px solid var(--accent); border-radius:10px; padding:12px 14px;
    backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
    box-shadow:var(--accent-glow-subtle);
  }
  .onboarding-text { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); line-height:1.7; margin-bottom:10px; }
  .onboarding-text strong { color:var(--accent); }
  .onboarding-examples { display:flex; flex-wrap:wrap; gap:6px; }
  .btn-example {
    background:var(--surface); border:1px solid var(--border); border-radius:6px;
    padding:5px 10px; font-family:'Space Mono',monospace; font-size:10px; color:var(--text);
    cursor:pointer; transition:border-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
  }
  .btn-example:hover { border-color:var(--accent); color:var(--accent); transform:translateY(-2px); box-shadow:var(--accent-glow-subtle); }
  .btn-example:active { transform:scale(0.95); box-shadow:none; }

  /* ── SHARE BUTTON ─── */
  .share-export-row {
    display:flex; gap:8px;
  }
  .btn-share, .btn-export-pdf {
    flex:1; background:var(--surface2); border:1px solid var(--border); border-radius:8px;
    padding:9px; font-family:'Space Mono',monospace; font-size:10px; color:var(--muted);
    cursor:pointer; transition:border-color 0.2s, color 0.2s;
    display:flex; align-items:center; justify-content:center; gap:6px;
  }
  .btn-share:hover { border-color:var(--accent); color:var(--accent); }
  .btn-export-pdf:hover { border-color:#a78bfa; color:#a78bfa; }
  .share-toast {
    position:fixed; bottom:24px; left:50%; transform:translateX(-50%) translateY(10px);
    background:var(--glass-bg); border:1px solid var(--accent); border-radius:8px;
    padding:10px 20px; font-family:'Space Mono',monospace; font-size:11px; color:var(--accent);
    opacity:0; transition:opacity 0.2s, transform 0.2s; pointer-events:none; z-index:999999;
    white-space:nowrap;
    backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
    box-shadow:var(--accent-glow);
  }
  .share-toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

  /* ── PDF EXPORT ─── */
  @media print {
    header, .upload-zone, .import-preview, .stock-form,
    .risk-score-bar, .whatif-panel, .share-export-row, .onboarding-banner,
    .btn-analyze, .btn-remove, .btn-refresh-market, .theme-toggle,
    .pick-hint, .etf-hint, .etf-drawer, .pick-drawer,
    .market-refresh-row, .sidebar, .sidebar-backdrop { display:none !important; }
    body { background:#fff !important; color:#000 !important; }
    .main-grid { grid-template-columns: 1fr !important; }
    .panel, .strategy-card, .analysis-bar { border:1px solid #ddd !important; }
  }

  /* ── PAYWALL MODAL ─── */
  .pw-card {
    background: linear-gradient(165deg, rgba(20,24,32,0.9) 0%, rgba(13,16,21,0.95) 100%);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 28px 24px 22px;
    max-width: 380px; width: 92%;
    max-height: 88vh; overflow-y: auto;
    font-family: Inter, sans-serif;
    position: relative;
    box-shadow: 0 24px 80px rgba(0,0,0,0.6), var(--accent-glow-subtle);
    backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  }
  .pw-close {
    position: absolute; top: 14px; right: 16px;
    background: none; border: none; color: #5a6478;
    font-size: 20px; cursor: pointer; z-index: 1;
    transition: color 0.15s;
  }
  .pw-close:hover { color: #e8ecf0; }

  .pw-hero { text-align: center; margin-bottom: 18px; }
  .pw-icon-ring {
    width: 48px; height: 48px; border-radius: 50%;
    background: linear-gradient(135deg, rgba(0,229,160,0.12), rgba(167,139,250,0.12));
    border: 1.5px solid rgba(0,229,160,0.25);
    display: inline-flex; align-items: center; justify-content: center;
    margin-bottom: 12px;
  }
  .pw-title {
    color: #e8ecf0; font-size: 22px; font-weight: 700;
    margin: 0 0 4px; letter-spacing: -0.3px;
  }
  .pw-subtitle {
    color: #6b7a90; font-size: 12px; margin: 0;
    font-family: 'Space Mono', monospace;
    white-space: pre-line;
  }

  .pw-features {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 6px 16px; margin-bottom: 20px;
    padding: 14px 16px;
    background: rgba(0,229,160,0.03);
    border: 1px solid rgba(0,229,160,0.08);
    border-radius: 12px;
  }
  .pw-feat {
    font-family: 'Space Mono', monospace; font-size: 10px;
    color: #c4cdd8; display: flex; align-items: center; gap: 6px;
  }
  .pw-check { color: #00e5a0; font-size: 11px; font-weight: 700; }

  .pw-tiers {
    display: grid; grid-template-columns: 1fr 1fr 1fr;
    gap: 8px; margin-bottom: 16px;
  }
  .pw-tier {
    border: 2px solid #1e2430; border-radius: 12px;
    padding: 12px 10px; text-align: center; cursor: pointer;
    transition: border-color 0.2s, background 0.2s, transform 0.15s;
    position: relative; opacity: 0.6;
  }
  .pw-tier:hover { background: rgba(255,255,255,0.02); transform: translateY(-2px); opacity: 0.85; box-shadow:var(--accent-glow-subtle); }
  .pw-tier:active { transform:scale(0.97); }
  .pw-tier-selected {
    border-color: #00e5a0 !important;
    background: rgba(0,229,160,0.05);
    opacity: 1;
    box-shadow:var(--accent-glow);
  }
  .pw-tier-badge {
    position: absolute; top: -9px; left: 50%; transform: translateX(-50%);
    background: #00e5a0; color: #000; font-size: 8px; font-weight: 700;
    padding: 2px 8px; border-radius: 4px;
    font-family: 'Space Mono', monospace; letter-spacing: 0.3px;
    text-transform: uppercase; white-space: nowrap;
    pointer-events: none;
  }
  .pw-tier-badge-save { background: #a78bfa; color: #fff; }
  .pw-tier-badge-deal { background: linear-gradient(135deg, #00e5a0, #a78bfa); color: #000; }
  .pw-tier > * { pointer-events: none; }
  .pw-tier-name {
    color: #e8ecf0; font-weight: 600; font-size: 13px;
    margin-top: 4px;
  }
  .pw-tier-price {
    color: #00e5a0; font-weight: 700; font-size: 18px;
    margin: 6px 0 2px; font-family: 'Space Mono', monospace;
  }
  .pw-tier-note {
    color: #5a6478; font-size: 9px;
    font-family: 'Space Mono', monospace;
  }

  .pw-cta {
    background: linear-gradient(135deg, #00e5a0, #00c98b);
    color: #000; border: none; border-radius: 12px;
    padding: 13px; font-size: 14px; font-weight: 700;
    cursor: pointer; width: 100%;
    font-family: Inter, sans-serif;
    transition: opacity var(--transition-fast), transform 0.1s, box-shadow var(--transition-med);
    box-shadow: var(--accent-glow);
    position:relative; overflow:hidden;
  }
  .pw-cta::before {
    content:''; position:absolute; top:0; left:-100%; width:60%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition:none; pointer-events:none;
  }
  .pw-cta:hover { opacity: 0.92; transform: translateY(-1px); box-shadow:var(--accent-glow-strong); }
  .pw-cta:hover::before { left:120%; transition:left 0.6s ease; }
  .pw-cta:active { transform: translateY(0); }
  .pw-restore {
    background: none; color: #5a6478; border: none;
    padding: 8px; font-size: 10px; cursor: pointer;
    width: 100%; font-family: 'Space Mono', monospace;
    transition: color 0.15s;
  }
  .pw-restore:hover { color: #8a9ab8; }
  .pw-restore-ios {
    color: #00e5a0; font-size: 13px; font-weight: 600;
    border: 1px solid rgba(0,229,160,0.3); border-radius: 10px;
    padding: 11px; margin-top: 4px;
  }
  .pw-restore-ios:hover { color: #00e5a0; opacity: 0.85; }

  /* Paywall light mode */
  body.light .pw-card {
    background: linear-gradient(165deg, #ffffff 0%, #f4f6f9 100%);
    border-color: #dde2ec;
    box-shadow: 0 24px 80px rgba(0,0,0,0.12), 0 0 0 1px rgba(0,229,160,0.08);
  }
  body.light .pw-close { color: #8a9ab8; }
  body.light .pw-close:hover { color: #0f1623; }
  body.light .pw-title { color: #0f1623; }
  body.light .pw-subtitle { color: #8a9ab8; }
  body.light .pw-features {
    background: rgba(0,229,160,0.04);
    border-color: rgba(0,229,160,0.12);
  }
  body.light .pw-feat { color: #3a4558; }
  body.light .pw-tier {
    border-color: #dde2ec;
    background: #fff;
  }
  body.light .pw-tier:hover { background: #f8f9fb; }
  body.light .pw-tier-selected {
    border-color: #00a87a !important;
    background: rgba(0,229,160,0.06);
  }
  body.light .pw-tier-name { color: #0f1623; }
  body.light .pw-tier-price { color: #00a87a; }
  body.light .pw-tier-note { color: #8a9ab8; }
  body.light .pw-cta {
    background: linear-gradient(135deg, #00a87a, #00c98b);
    box-shadow: 0 4px 20px rgba(0,168,122,0.2);
  }
  body.light .pw-restore { color: #8a9ab8; }
  body.light .pw-restore:hover { color: #3a4558; }

  @media (max-width: 420px) {
    .pw-features { grid-template-columns: 1fr; }
    .pw-tiers { grid-template-columns: 1fr; }
    .pw-tier { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; }
    .pw-tier-badge { left: 12px; transform: none; }
    .pw-tier-name { margin: 0; text-align: left; }
    .pw-tier-price { margin: 0; font-size: 16px; }
    .pw-tier-note { display: none; }
  }

  /* ── UI IMPROVEMENTS ─── */

  /* 1. Smooth holdings collapse animation */
  #holdingsBody {
    overflow: hidden;
    transition: max-height 0.35s cubic-bezier(0.4,0,0.2,1), opacity 0.2s ease;
  }
  #holdingsBody.collapsed {
    max-height: 0 !important;
    opacity: 0;
  }

  /* 2. Best match strategy label + card glow */
  .strategy-card:has(.strategy-best-match) { border-color:rgba(0,229,160,0.2); box-shadow:var(--glass-shadow), var(--accent-glow-subtle); }
  .strategy-best-match {
    display: inline-block;
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--accent);
    background: rgba(0,229,160,0.1);
    border: 1px solid rgba(0,229,160,0.25);
    border-radius: 4px;
    padding: 1px 6px;
    margin-left: 0;
  }

  /* 3. Compact upload zone */
  .upload-compact-trigger {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 4px 24px 12px;
    padding: 10px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
  }
  .upload-compact-trigger:hover { border-color: var(--accent); color: var(--text); }
  .upload-compact-trigger .upload-compact-icon { font-size: 14px; }
  .upload-compact-trigger .upload-compact-chevron {
    margin-left: auto;
    font-size: 10px;
    color: var(--muted);
    transition: transform 0.25s ease;
  }
  .upload-compact-trigger.expanded .upload-compact-chevron { transform: rotate(90deg); }
  .upload-expanded { display: none; }
  .upload-expanded.expanded { display: block; }

  /* 4. Staggered fade-in on result sections */
  .health-panel { animation: fadeUp 0.4s ease backwards; animation-delay: 0.05s; }
  .rebalance-panel { animation: fadeUp 0.4s ease backwards; animation-delay: 0.1s; }
  .recommended-panel { overflow: visible; }
  .recommended-body { padding: 12px 16px 16px; display: flex; flex-direction: column; gap: 12px; }
  .recommended-body .strategy-card { margin-bottom: 0; }

  /* 5. Improved empty state */
  .empty-compass {
    position: relative;
    width: 88px;
    height: 88px;
    margin: 0 auto 18px;
  }
  .empty-compass-ring {
    width: 72px;
    height: 72px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: emptyPulse 3s ease-in-out infinite;
    box-shadow: 0 0 20px rgba(0,229,160,0.2), 0 0 40px rgba(0,229,160,0.05);
  }
  .empty-compass-needle {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 2px;
    height: 28px;
    background: linear-gradient(to top, var(--aggressive) 50%, var(--accent) 50%);
    border-radius: 1px;
    transform-origin: bottom center;
    transform: translate(-50%, -100%) rotate(0deg);
    animation: emptyNeedleSway 4s ease-in-out infinite;
    filter: drop-shadow(0 0 4px rgba(0,229,160,0.5));
  }
  .empty-compass-center {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 6px;
    height: 6px;
    background: var(--text);
    border-radius: 50%;
    transform: translate(-50%, -50%);
  }
  @keyframes emptyPulse {
    0%, 100% { border-top-color: var(--accent); opacity: 0.6; box-shadow: 0 0 20px rgba(0,229,160,0.2); }
    50% { border-top-color: var(--moderate); opacity: 1; box-shadow: 0 0 25px rgba(255,209,102,0.25); }
  }
  @keyframes emptyNeedleSway {
    0%, 100% { transform: translate(-50%, -100%) rotate(-20deg); }
    50% { transform: translate(-50%, -100%) rotate(20deg); }
  }
  .empty-state-title {
    font-family: 'DM Sans', sans-serif;
    font-size: 18px;
    font-weight: 600;
    background: var(--accent-gradient-text);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
  }
  .empty-state-hint {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    line-height: 1.7;
  }
  .empty-state-hint strong { color: var(--text); }

  /* 7. What-If Simulator promotion */
  .whatif-promoted {
    animation: whatifGlow 2s ease-in-out;
    position: relative;
  }
  @keyframes whatifGlow {
    0% { border-color: var(--border); box-shadow: none; }
    20% { border-color: var(--accent); box-shadow: 0 0 12px rgba(0,229,160,0.3); }
    80% { border-color: var(--accent); box-shadow: 0 0 12px rgba(0,229,160,0.3); }
    100% { border-color: var(--border); box-shadow: none; }
  }
  .whatif-promoted::after {
    content: 'NEW';
    position: absolute;
    top: -8px;
    right: 12px;
    background: var(--accent);
    color: #000;
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    font-weight: 700;
    letter-spacing: 1px;
    padding: 2px 6px;
    border-radius: 4px;
    animation: fadeIn 0.3s ease, fadeOut 0.5s ease 4.5s forwards;
  }
  @keyframes fadeOut { to { opacity: 0; } }

  /* 8. Compact holdings grid view */
  .holdings-view-toggle {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 10px 24px 8px;
  }
  .holdings-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    color: var(--text);
    letter-spacing: 0.5px;
    text-transform: uppercase;
    margin-right: 6px;
  }
  .holdings-market-status {
    margin-left: auto;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    white-space: nowrap;
  }
  .holdings-market-status.live { color: #22c55e; }
  .holdings-view-toggle .pstrip-refresh {
    margin-left: 6px;
    flex-shrink: 0;
  }
  .view-btn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 3px 8px;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    cursor: pointer;
    transition: border-color 0.2s, color 0.2s, background 0.2s;
  }
  .view-btn:hover { border-color: var(--accent); color: var(--text); }
  .view-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(0,229,160,0.08); }
  .holdings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 6px;
    padding: 12px 24px;
  }
  .holdings-grid-item {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 10px;
    text-align: center;
    cursor: pointer;
    transition: border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    animation: slideIn 0.2s ease;
  }
  .holdings-grid-item:hover { border-color: var(--aggressive); transform:translateY(-2px); box-shadow:var(--aggressive-glow); }
  .grid-ticker {
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
  }
  .grid-pct {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    font-weight: 700;
    margin-top: 2px;
  }

  /* 9. ETF vs Stock visual distinction */
  .etf-type-etf { border-left: 3px solid rgba(77,159,255,0.4); }
  .etf-type-stock { border-left: 3px solid rgba(255,140,66,0.3); }

  /* 10. Gradient text on result section titles */
  .results-panel .section-title {
    background: var(--accent-gradient-text);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* 11. Custom scrollbar */
  ::-webkit-scrollbar { width:6px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.1); border-radius:3px; }
  ::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,0.2); }
  body.light ::-webkit-scrollbar-thumb { background:rgba(0,0,0,0.12); }
  body.light ::-webkit-scrollbar-thumb:hover { background:rgba(0,0,0,0.2); }

  /* 12. Sector bar fills glow */
  .sector-bar-fill { box-shadow:0 0 6px currentColor; }

  /* 13. Mobile sticky button enhanced glow */
  @media (max-width: 900px) {
    .btn-analyze-sticky.visible {
      box-shadow: 0 -4px 20px rgba(0,0,0,0.5), 0 -8px 30px rgba(0,229,160,0.2);
    }
  }

  /* 14. Portfolio Strip */
  .portfolio-strip {
    display: none;
    gap: 6px;
    padding: 10px 20px;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
    border-bottom: 1px solid var(--border);
  }
  .portfolio-strip.visible { display: flex; }
  .portfolio-strip::-webkit-scrollbar { display: none; }

  .pstrip-card {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 14px 8px 0;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    border-left: 3px solid var(--muted);
    cursor: pointer;
    transition: border-color var(--transition-fast), background var(--transition-fast);
    white-space: nowrap;
    position: relative;
    min-width: 110px;
  }
  .pstrip-card:hover { border-color: var(--accent); }
  .pstrip-card.active {
    border-color: var(--accent);
    background: rgba(0,229,160,0.06);
  }
  .pstrip-card.active .pstrip-name {
    background: var(--accent-gradient-text);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .pstrip-info { padding-left: 12px; }
  .pstrip-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 600;
    color: var(--text);
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
  }
  .pstrip-count {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    line-height: 1.2;
  }
  .pstrip-edit {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 11px;
    padding: 2px 4px;
    opacity: 0.5;
    transition: opacity var(--transition-fast);
  }
  .pstrip-edit:hover { opacity: 1; color: var(--accent); }
  .pstrip-change {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    line-height: 1;
    margin-left: auto;
  }
  .pstrip-change.up { color: #00e5a0; }
  .pstrip-change.down { color: #ff4d6d; }
  .pstrip-change.flat { color: var(--muted); }
  .pstrip-change.loading {
    color: var(--muted);
    font-size: 9px;
    animation: pstrip-pulse 1.4s ease-in-out infinite;
  }
  @keyframes pstrip-pulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
  }
  body.light .pstrip-change.up { color: #00a87a; }
  body.light .pstrip-change.down { color: #e02a4a; }

  .pstrip-refresh {
    flex: 0 0 auto;
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--muted);
    font-size: 14px;
    width: 28px;
    height: 28px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
    align-self: center;
  }
  .pstrip-refresh:hover { color: var(--accent); border-color: var(--accent); }
  .pstrip-refresh.spinning {
    animation: pstrip-spin 0.8s linear infinite;
    color: var(--accent);
    pointer-events: none;
  }
  .pstrip-refresh.spin-once {
    animation: pstrip-spin 0.6s ease-out;
    color: var(--accent);
    pointer-events: none;
  }
  @keyframes pstrip-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .pstrip-status {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 1px;
    flex: 0 0 auto;
    align-self: center;
    margin-left: auto;
  }
  .pstrip-market {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    color: var(--muted);
    white-space: nowrap;
  }
  .pstrip-market.live { color: #22c55e; }
  .pstrip-updated {
    font-family: 'Space Mono', monospace;
    font-size: 7px;
    color: var(--muted);
    opacity: 0.6;
  }

  .pstrip-movers-label {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    align-self: center;
    white-space: nowrap;
    opacity: 0.6;
  }
  .pstrip-mover {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    white-space: nowrap;
    font-size: 11px;
  }
  .pstrip-mover-ticker {
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 11px;
    color: var(--text);
  }
  .pstrip-divider {
    width: 1px;
    height: 24px;
    background: var(--border);
    flex-shrink: 0;
    align-self: center;
    margin: 0 2px;
  }

  @media (max-width: 900px) {
    .portfolio-strip { padding: 8px 16px; gap: 6px; }
  }

  /* 15. Navigation Bar */
  .bottom-bar {
    position: fixed;
    left: 0;
    right: 0;
    z-index: 10002;
    display: flex;
    justify-content: space-around;
    align-items: stretch;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  .bottom-bar::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent 0%, rgba(0,229,160,0.3) 50%, transparent 100%);
    pointer-events: none;
  }
  .bottom-bar-tab {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 3px;
    padding: 8px 0 6px;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    transition: color var(--transition-fast);
    position: relative;
    -webkit-tap-highlight-color: transparent;
  }
  .bottom-bar-tab span {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    letter-spacing: 0.3px;
  }
  .bottom-bar-tab:hover { color: var(--text); }
  .bottom-bar-tab.active { color: var(--accent); }
  .bottom-bar-icon {
    width: 19px;
    height: 19px;
  }

  /* Bottom bar — all screen sizes */
  .bottom-bar {
    bottom: 0;
    top: auto;
    border-top: 1px solid var(--glass-border);
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }
  .bottom-bar::before { top: -1px; bottom: auto; }
  .bottom-bar-tab.active::after {
    content: '';
    position: absolute;
    top: 0; bottom: auto;
    left: 25%; right: 25%;
    height: 2px;
    background: var(--accent);
    border-radius: 0 0 2px 2px;
  }
  body { padding-bottom: 56px; }

  /* Hide old sticky analyze button — replaced by nav bar */
  .btn-analyze-sticky { display: none !important; }

  /* 16. Portfolio Drawer (popover above Portfolios tab) */
  .portfolio-drawer {
    position: fixed;
    inset: 0;
    z-index: 10001;
    background: rgba(0,0,0,0);
    pointer-events: none;
    transition: background var(--transition-med);
  }
  .portfolio-drawer.open {
    background: rgba(0,0,0,0.4);
    pointer-events: auto;
  }
  .pdrawer-panel {
    position: absolute;
    bottom: calc(52px + env(safe-area-inset-bottom, 0px));
    left: 12px;
    width: 280px;
    max-height: 50vh;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow-y: auto;
    box-shadow: 0 -8px 40px rgba(0,0,0,0.4);
    opacity: 0;
    transform: translateY(8px) scale(0.97);
    transition: opacity var(--transition-fast), transform var(--transition-fast);
  }
  .portfolio-drawer.open .pdrawer-panel {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  .pdrawer-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 16px 20px 12px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    background: var(--surface);
    z-index: 1;
  }
  .pdrawer-title {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    color: var(--muted);
    letter-spacing: 1.5px;
    text-transform: uppercase;
  }
  .pdrawer-add {
    background: none;
    border: 1px solid var(--border);
    color: var(--accent);
    font-size: 16px;
    cursor: pointer;
    padding: 2px 10px;
    border-radius: 6px;
    margin-left: auto;
    transition: color var(--transition-fast), background var(--transition-fast), border-color var(--transition-fast);
  }
  .pdrawer-add:hover { background: rgba(0,229,160,0.1); border-color: var(--accent); }
  .pdrawer-close {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 16px;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
    transition: color var(--transition-fast), background var(--transition-fast);
  }
  .pdrawer-close:hover { color: var(--text); background: var(--surface2); }
  .pdrawer-list { padding: 8px 12px; display: flex; flex-direction: column; gap: 4px; }
  .pdrawer-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    border-left: 3px solid var(--muted);
    cursor: pointer;
    transition: border-color var(--transition-fast), background var(--transition-fast);
  }
  .pdrawer-item:hover { border-color: var(--accent); }
  .pdrawer-item.active {
    border-color: var(--accent);
    background: rgba(0,229,160,0.06);
  }
  .pdrawer-info { flex: 1; min-width: 0; }
  .pdrawer-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .pdrawer-change {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    flex-shrink: 0;
  }
  .pdrawer-change.up { color: #00e5a0; }
  .pdrawer-change.down { color: #ff4d6d; }
  .pdrawer-change.flat { color: var(--muted); }
  body.light .pdrawer-change.up { color: #00a87a; }
  body.light .pdrawer-change.down { color: #e02a4a; }
  .pdrawer-delete {
    background: rgba(255,100,100,0.08);
    border: 1px solid rgba(255,100,100,0.15);
    color: #ff6b6b;
    font-size: 14px;
    cursor: pointer;
    min-width: 36px;
    min-height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2px 6px;
    border-radius: 4px;
    line-height: 1;
    transition: color 0.15s, background 0.15s;
    flex-shrink: 0;
  }
  .pdrawer-delete:hover, .pdrawer-delete:active { color: #fff; background: rgba(255,100,100,0.25); border-color: rgba(255,100,100,0.4); }
  .pdrawer-item.active .pdrawer-name {
    background: var(--accent-gradient-text);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .pdrawer-count {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
  }
  .pdrawer-star {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 18px;
    cursor: pointer;
    padding: 2px 6px 2px 0;
    flex-shrink: 0;
    line-height: 1;
    transition: color 0.15s;
  }
  .pdrawer-star:hover { color: #ffd166; }
  .pdrawer-star.active { color: #ffd166; }
  .pstrip-star {
    color: #ffd166;
    font-size: 10px;
    margin-right: 3px;
  }
  .pdrawer-empty {
    padding: 24px 20px;
    text-align: center;
    font-size: 13px;
    color: var(--muted);
    line-height: 1.6;
  }

  /* ── SPARKLINE CHART GRID ──────────────────────────────── */
  .sparkline-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 10px;
    padding: 12px 24px;
  }
  .sparkline-card {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 10px 12px 8px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    box-shadow: var(--glass-shadow);
    transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
    animation: slideIn 0.25s ease backwards;
  }
  .sparkline-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--glass-shadow), var(--accent-glow-subtle);
    border-color: var(--accent);
  }
  .spark-card-header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 4px;
    margin-bottom: 2px;
  }
  .spark-card-ticker {
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
  }
  .spark-card-alloc {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    font-weight: 600;
    color: var(--muted);
    opacity: 0.7;
    cursor: pointer;
    border-radius: 3px;
    padding: 1px 3px;
    transition: background 0.15s, color 0.15s;
  }
  .spark-card-alloc:hover { background: var(--surface2); color: var(--text); opacity: 1; }
  .spark-card-alloc-input {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    font-weight: 600;
    width: 40px;
    background: var(--surface2);
    border: 1px solid var(--accent);
    border-radius: 4px;
    padding: 1px 3px;
    color: var(--text);
    outline: none;
    text-align: right;
  }
  .spark-card-remove {
    position: absolute;
    top: 4px;
    right: 4px;
    background: rgba(0,0,0,0.5);
    border: none;
    color: var(--muted);
    font-size: 12px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.15s, color 0.15s, background 0.15s;
    z-index: 2;
    line-height: 1;
    padding: 0;
  }
  .sparkline-card:hover .spark-card-remove { opacity: 1; }
  .spark-card-remove:hover { color: var(--aggressive); background: rgba(255,140,66,0.2); }
  @media (hover: none) {
    .spark-card-remove { opacity: 0.7; }
  }
  .spark-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 9px;
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 6px;
  }
  .spark-chart {
    width: 100%;
    height: 50px;
    overflow: hidden;
    position: relative;
  }
  .spark-chart svg {
    display: block;
    width: 100%;
    height: 100%;
  }
  .spark-shimmer {
    width: 100%;
    height: 50px;
    border-radius: 4px;
    background: linear-gradient(90deg, var(--surface2) 25%, var(--border) 50%, var(--surface2) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s ease-in-out infinite;
  }
  @keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
  .spark-card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 4px;
  }
  .spark-price {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    font-weight: 700;
    color: var(--text);
  }
  .spark-change {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    font-weight: 700;
    padding: 1px 5px;
    border-radius: 4px;
  }
  .spark-change.up {
    color: #22c55e;
    background: rgba(34, 197, 94, 0.1);
  }
  .spark-change.down {
    color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
  }
  .spark-sector-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    position: absolute;
    bottom: 8px;
    left: 12px;
  }

  /* ── EXPANDED CHART MODAL ────────────────────────────── */
  .chart-modal-overlay {
    position: fixed;
    inset: 0;
    z-index: 10002;
    background: rgba(0, 0, 0, 0);
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    transition: background 0.25s;
    padding: 16px;
  }
  .chart-modal-overlay.open {
    background: rgba(0, 0, 0, 0.55);
    pointer-events: auto;
  }
  .chart-modal-card {
    background: var(--surface);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 24px 20px 20px;
    max-width: 520px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 24px 80px rgba(0, 0, 0, 0.5);
    opacity: 0;
    transform: translateY(12px) scale(0.97);
    transition: opacity 0.25s, transform 0.25s;
  }
  .chart-modal-overlay.open .chart-modal-card {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  .chart-modal-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  .chart-modal-ticker {
    font-family: 'DM Sans', sans-serif;
    font-size: 22px;
    font-weight: 700;
    color: var(--text);
  }
  .chart-modal-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    color: var(--muted);
    margin-top: 2px;
  }
  .chart-modal-sector {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    margin-top: 2px;
  }
  .chart-modal-price-row {
    display: flex;
    align-items: baseline;
    gap: 8px;
    margin-top: 4px;
  }
  .chart-modal-price {
    font-family: 'Space Mono', monospace;
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
  }
  .chart-modal-change {
    font-family: 'Space Mono', monospace;
    font-size: 15px;
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 6px;
  }
  .chart-modal-change.up { color: #22c55e; background: rgba(34,197,94,0.15); }
  .chart-modal-change.down { color: #ef4444; background: rgba(239,68,68,0.15); }
  .chart-modal-alloc {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    margin-top: 4px;
  }
  .chart-modal-close {
    background: none;
    border: 1px solid var(--border);
    border-radius: 8px;
    width: 32px;
    height: 32px;
    font-size: 18px;
    color: var(--muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: border-color 0.2s, color 0.2s;
  }
  .chart-modal-close:hover {
    border-color: var(--accent);
    color: var(--text);
  }
  .chart-modal-ranges {
    display: flex;
    gap: 4px;
    margin-bottom: 12px;
  }
  .chart-range-btn {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    padding: 4px 10px;
    border: 1px solid var(--border);
    border-radius: 5px;
    background: none;
    color: var(--muted);
    cursor: pointer;
    transition: border-color 0.2s, color 0.2s, background 0.2s;
  }
  .chart-range-btn:hover { border-color: var(--accent); color: var(--text); }
  .chart-range-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(0,229,160,0.08); }

  /* Portfolio Overview Chart */
  .portfolio-overview {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px 18px;
    margin: 8px 0 12px;
  }
  .portfolio-overview-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .portfolio-overview-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 600;
    color: var(--text);
  }
  .portfolio-overview-edit {
    background: none;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    font-weight: 600;
    padding: 4px 12px;
    cursor: pointer;
    transition: border-color 0.15s, color 0.15s;
  }
  .portfolio-overview-edit:hover { border-color: var(--accent); color: var(--text); }
  .portfolio-overview-ranges {
    display: flex;
    gap: 6px;
    margin-bottom: 10px;
  }
  .portfolio-overview-chart {
    width: 100%;
    height: 220px;
    overflow: hidden;
    border-radius: 8px;
    position: relative;
  }
  .portfolio-overview-chart img, .portfolio-overview-chart svg {
    width: 100%;
    height: 100%;
    display: block;
  }
  .portfolio-overview-perf {
    display: flex;
    justify-content: center;
    margin-top: 8px;
  }
  .portfolio-perf-badge {
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 6px;
  }
  .portfolio-perf-badge.up { color: #22c55e; background: rgba(34,197,94,0.1); }
  .portfolio-perf-badge.down { color: #ef4444; background: rgba(239,68,68,0.1); }
  .portfolio-perf-badge.flat { color: var(--muted); background: rgba(90,100,120,0.1); }

  .chart-modal-chart {
    width: 100%;
    height: 200px;
    overflow: hidden;
    margin-bottom: 12px;
    position: relative;
  }
  .chart-modal-chart svg {
    display: block;
    width: 100%;
    height: 100%;
  }
  .chart-modal-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px 16px;
  }
  .chart-stat {
    display: flex;
    justify-content: space-between;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
  }
  .chart-stat-label { color: var(--muted); }
  .chart-stat-value { color: var(--text); font-weight: 700; }

  /* ── PORTFOLIO NEWS PANEL ────────────────────────────── */
  .news-list { padding: 4px 20px 12px; }
  .news-item {
    display: block;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
    text-decoration: none;
    color: var(--text);
    transition: opacity 0.15s;
  }
  .news-item:last-child { border-bottom: none; }
  .news-item:hover { opacity: 0.8; }
  .news-item-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
  }
  .news-item-ticker {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    color: var(--accent);
  }
  .news-item-meta {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
  }
  .news-item-title {
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    line-height: 1.4;
  }
  .news-loading, .news-empty {
    font-size: 11px;
    color: var(--muted);
    padding: 12px 0;
    text-align: center;
  }
  .chart-modal-news { padding: 0 4px; margin-top: 12px; }
  .chart-news-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
  }

  /* ── SPARKLINE MOBILE ────────────────────────────────── */
  @media (max-width: 600px) {
    .sparkline-grid {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      padding: 10px 16px;
    }
    .sparkline-card { padding: 8px 10px 6px; }
    .spark-chart, .spark-shimmer { height: 40px; }
    .chart-modal-card {
      padding: 18px 14px 14px;
      border-radius: 12px;
    }
    .chart-modal-ticker { font-size: 18px; }
    .chart-modal-price { font-size: 15px; }
    .chart-modal-chart { height: 160px; }
    .chart-modal-overlay { padding: 10px; }
  }

  /* ── NAV PANEL (shared overlay for Market, Explore) ─────── */
  .nav-panel-overlay {
    position: fixed;
    inset: 0;
    z-index: 10001;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: flex-end;
    justify-content: center;
  }
  .nav-panel-overlay.open { display: flex; }
  .nav-panel {
    width: 100%;
    max-width: 520px;
    max-height: 75vh;
    background: var(--surface);
    border: 1px solid var(--glass-border);
    border-radius: 16px 16px 0 0;
    overflow-y: auto;
    padding: 0 0 calc(60px + env(safe-area-inset-bottom, 0px));
    animation: navPanelSlideUp 0.25s ease;
  }
  @keyframes navPanelSlideUp {
    from { transform: translateY(100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .nav-panel-header {
    position: sticky;
    top: 0;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 16px 18px 12px;
    background: var(--surface);
    border-bottom: 1px solid var(--glass-border);
    z-index: 1;
  }
  .nav-panel-title {
    flex: 1;
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
  }
  .nav-panel-close {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 20px;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
  }
  .nav-panel-close:hover { color: var(--text); background: var(--glass-bg); }

  /* Panel drag handle */
  .panel-drag-handle {
    background: none;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-size: 14px;
    width: 28px;
    height: 28px;
    cursor: grab;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.15s, border-color 0.15s;
    margin-right: 8px;
    user-select: none;
    -webkit-user-select: none;
  }
  .panel-drag-handle:hover { color: var(--accent); border-color: var(--accent); }
  .panel-drag-handle:active { cursor: grabbing; }

  /* Panel dragging state */
  .panel-dragging {
    position: fixed !important;
    z-index: 10001 !important;
    opacity: 0.85;
    pointer-events: none;
    transition: none !important;
    box-shadow: 0 12px 40px rgba(0,0,0,0.4);
  }
  body.dragging-panel { user-select: none; -webkit-user-select: none; }

  /* Drop zone highlight */
  .panel-drop-zone {
    outline: 2px dashed var(--accent);
    outline-offset: -2px;
    background: rgba(0,229,160,0.04);
    transition: outline-color 0.2s, background 0.2s;
  }

  /* Snapped panel in results area */
  .panel-snapped-wrapper {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 16px;
    box-shadow: var(--glass-shadow);
  }
  .panel-snapped-wrapper .nav-panel { max-height: none; }
  .panel-snapped-wrapper .nav-panel-header {
    position: relative;
    border-bottom: 1px solid var(--border);
  }
  .panel-snapped-popout {
    background: none;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-size: 12px;
    padding: 4px 10px;
    cursor: pointer;
    margin-right: 8px;
    transition: color 0.15s, border-color 0.15s;
  }
  .panel-snapped-popout:hover { color: var(--accent); border-color: var(--accent); }

  /* iOS move-mode visual cue */
  .panel-move-mode {
    outline: 2px solid var(--accent);
    outline-offset: -1px;
    box-shadow: 0 0 0 4px rgba(0,229,160,0.15);
  }

  .nav-panel-refresh {
    background: none;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-size: 16px;
    width: 28px;
    height: 28px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.15s, border-color 0.15s;
    margin-right: 8px;
  }
  .nav-panel-refresh:hover { color: var(--accent); border-color: var(--accent); }
  .nav-panel-refresh.spinning { animation: pstrip-spin 0.8s linear infinite; color: var(--accent); pointer-events: none; }
  .nav-panel-body { padding: 14px 18px; }

  /* ── Market Panel ──────────────────────────────────────── */
  .market-section-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--muted);
    margin: 16px 0 8px;
  }
  .market-section-label:first-child { margin-top: 0; }
  .market-mover-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid var(--glass-border);
  }
  .market-mover-row:last-child { border-bottom: none; }
  .market-mover-ticker {
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    min-width: 50px;
  }
  .market-mover-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: var(--muted);
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .market-mover-price {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    color: var(--text);
    min-width: 60px;
    text-align: right;
  }
  .market-mover-change {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    min-width: 55px;
    text-align: right;
    padding: 2px 6px;
    border-radius: 4px;
  }
  .market-mover-change.up { color: #22c55e; background: rgba(34,197,94,0.1); }
  .market-mover-change.down { color: #ef4444; background: rgba(239,68,68,0.1); }
  .market-mover-change.flat { color: var(--muted); }
  .market-status-card {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 14px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    margin-bottom: 12px;
  }
  .market-status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
  }
  .market-status-dot.live { background: #22c55e; box-shadow: 0 0 6px rgba(34,197,94,0.5); }
  .market-status-label {
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    color: var(--text);
    font-weight: 600;
  }
  .market-status-sub {
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: var(--muted);
  }

  /* ── Explore Panel ─────────────────────────────────────── */
  .explore-sector-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 8px;
  }
  .explore-sector-card {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  .explore-sector-card:hover {
    border-color: var(--accent);
    transform: translateY(-1px);
  }
  .explore-sector-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .explore-sector-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    color: var(--text);
    font-weight: 600;
  }
  .explore-sector-count {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    margin-left: auto;
  }
  .explore-stock-list { margin-top: 10px; }
  .explore-stock-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 0;
    border-bottom: 1px solid var(--glass-border);
    cursor: pointer;
  }
  .explore-stock-row:hover { background: var(--glass-bg); margin: 0 -18px; padding: 7px 18px; border-radius: 6px; }
  .explore-stock-ticker {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    font-weight: 700;
    color: var(--accent);
    min-width: 48px;
  }
  .explore-stock-name {
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: var(--muted);
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .explore-stock-sector {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    padding: 1px 5px;
    border: 1px solid var(--glass-border);
    border-radius: 4px;
  }
  .explore-back-btn {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: none;
    border: none;
    color: var(--accent);
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    cursor: pointer;
    padding: 6px 0;
    margin-bottom: 8px;
  }
  .explore-back-btn:hover { text-decoration: underline; }
  .explore-search-input {
    width: 100%;
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid var(--glass-border);
    background: var(--glass-bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    outline: none;
    margin-bottom: 12px;
    box-sizing: border-box;
  }
  .explore-search-input::placeholder { color: var(--muted); }
  .explore-search-input:focus { border-color: var(--accent); }

  @media print {
    .bottom-bar, .portfolio-drawer, .nav-panel-overlay { display: none !important; }
  }
