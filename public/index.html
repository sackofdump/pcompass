<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Portfolio Compass</title>
<meta name="description" content="Analyze your stock portfolio, get AI-powered recommendations, and track sector exposure.">
<meta name="theme-color" content="#0a0c10">
<meta property="og:title" content="Portfolio Compass ‚Äî AI Stock Portfolio Analyzer">
<meta property="og:description" content="Enter your holdings, get personalized AI-powered stock & ETF recommendations. See your risk level, diversification score, and sector gaps instantly.">
<meta property="og:image" content="https://pcompass.vercel.app/icons/icon-512.png">
<meta property="og:url" content="https://pcompass.vercel.app">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Portfolio Compass ‚Äî AI Stock Portfolio Analyzer">
<meta name="twitter:description" content="Enter your holdings, get personalized AI-powered stock & ETF recommendations.">
<meta name="twitter:image" content="https://pcompass.vercel.app/icons/icon-512.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-192.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-192.png">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="PCompass">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/styles.css">
<style>
  .splash-loader{position:fixed;inset:0;background:#0a0c10;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:999999;transition:opacity 0.35s ease;}
  .splash-loader.fade-out{opacity:0;pointer-events:none;}
  body.light .splash-loader{background:#f4f6f9;}
  .splash-compass{width:56px;height:56px;border:2px solid #2a3140;border-radius:50%;position:relative;display:flex;align-items:center;justify-content:center;animation:splashPulse 1.8s ease-in-out infinite;}
  .splash-needle{position:absolute;inset:0;animation:splashSpin 2s ease-in-out infinite;}
  .splash-needle::before{content:'';position:absolute;width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:16px solid #00e5a0;top:5px;left:50%;transform:translateX(-50%);filter:drop-shadow(0 0 6px rgba(0,229,160,0.7));}
  .splash-needle::after{content:'';position:absolute;width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:16px solid #ff8c42;bottom:5px;left:50%;transform:translateX(-50%);opacity:0.55;}
  .splash-compass-dot{width:5px;height:5px;background:#e8ecf0;border-radius:50%;position:absolute;z-index:2;}
  @keyframes splashPulse{0%,100%{box-shadow:0 0 0 0 rgba(0,229,160,0.3);}50%{box-shadow:0 0 0 14px rgba(0,229,160,0);}}
  @keyframes splashSpin{0%{transform:rotate(0deg);}30%{transform:rotate(120deg);}50%{transform:rotate(90deg);}80%{transform:rotate(330deg);}100%{transform:rotate(360deg);}}
  .splash-title{margin-top:18px;font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:#e8ecf0;}
  .splash-title span{color:#00e5a0;}
  body.light .splash-title{color:#1a1f2e;}
  body.light .splash-compass{border-color:#c8cdd8;}
  body.light .splash-compass-dot{background:#1a1f2e;}
</style>
</head>
<body>
<div class="splash-loader" id="splashLoader">
  <div class="splash-compass"><div class="splash-needle"></div><div class="splash-compass-dot"></div></div>
  <div class="splash-title">Portfolio <span>Compass</span></div>
</div>

<header class="header-compact" onclick="window.scrollTo({top:0,behavior:'smooth'})" style="cursor:pointer;">
  <div class="logo">
    <div class="logo-icon">
      <div class="logo-icon-center"></div>
    </div>
    <h1>Portfolio <span>Compass</span></h1>
    <span class="tagline" style="display:none;">Portfolio Diversification &amp; Strategy Analyzer</span>
  </div>
  <div class="header-actions" style="display:none;">
    <button onclick="showPaywall('header')" id="btnPro" style="display:none;">‚ú¶ Get Pro</button>
    <button class="user-pill" id="userPill" onclick="event.stopPropagation();toggleSidebar()" style="display:none;">
      <span class="user-pill-name" id="userPillName">‚ò∞ Menu</span>
      <span class="user-pill-avatar" id="userPillAvatar"></span>
      <span class="user-pill-chevron">‚ñ∏</span>
    </button>
  </div>
</header>

<!-- Sidebar backdrop + panel -->
<div class="sidebar-backdrop" id="sidebarBackdrop" onclick="closeSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <button class="sidebar-close" onclick="closeSidebar()">‚úï</button>
  </div>
  <div class="sidebar-user" id="sidebarUser"></div>
  <div class="sidebar-section">
    <div class="sidebar-section-title">Quick Access</div>
    <div class="sidebar-nav-links" id="sidebarNavLinks">
      <button class="sidebar-nav-btn" onclick="closeSidebar();navTo('portfolios')"><span class="sidebar-nav-icon">&#9776;</span> My Portfolios</button>
      <button class="sidebar-nav-btn" onclick="closeSidebar();navTo('explore')"><span class="sidebar-nav-icon">&#9733;</span> Explore Stocks</button>
      <button class="sidebar-nav-btn" onclick="closeSidebar();navTo('news')"><span class="sidebar-nav-icon">&#9670;</span> Portfolio News</button>
    </div>
  </div>
  <div class="sidebar-section">
    <div class="sidebar-section-title">Settings</div>
    <div class="sidebar-settings" id="sidebarSettings"></div>
  </div>
  <div class="sidebar-section" id="sidebarAccount"></div>
  <div class="sidebar-footer">
    <a href="/privacy.html">Privacy</a> ¬∑ <a href="/terms.html">Terms</a> ¬∑ <a href="/support.html">Support</a>
  </div>
</div>

<div class="main-grid container">
  <!-- Left: Input Panel -->
  <div>
    <div class="panel">
      <div class="panel-header" style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;" onclick="toggleHoldingsBody()">
        <div style="display:flex;align-items:center;gap:6px;">
          <h2 class="section-title" style="margin:0;">Your Holdings</h2>
          <span id="holdingsChevron" style="color:var(--muted);font-size:12px;transition:transform 0.2s;">&#9662;</span>
        </div>
        <div style="display:flex;gap:6px;align-items:center;" onclick="event.stopPropagation();">
          <button class="slot-btn" id="btnNewPortfolio" onclick="newPortfolio()" title="New portfolio" style="display:none;">Ôºã</button>
          <button class="slot-btn" id="btnClearAll" onclick="clearAllHoldings()" title="Clear all holdings">üóë</button>
          <button class="slot-btn" id="btnQuickSave" onclick="savePortfolio()" title="Save portfolio" style="display:none;">üíæ</button>
          <button class="slot-btn" onclick="sharePortfolio()" title="Share portfolio link">üîó</button>
          <button class="slot-btn" onclick="exportPDF()" title="Export PDF">‚¨á</button>
        </div>
      </div>

      <div class="portfolio-strip" id="portfolioStrip"></div>

      <div id="holdingsBody">
      <!-- Onboarding banner (hidden after first use) -->
      <div class="onboarding-banner" id="onboardingBanner" style="position:relative;">
        <div class="onboarding-text">üëã <strong>Welcome!</strong> Add your stock holdings below, or try an example portfolio to see how it works.</div>
        <div class="onboarding-examples">
          <button class="btn-example" onclick="loadExample('tech')">üöÄ Aggressive</button>
          <button class="btn-example" onclick="loadExample('balanced')">‚öñÔ∏è Balanced</button>
          <button class="btn-example" onclick="loadExample('conservative')">üõ°Ô∏è Conservative</button>
          <button class="btn-example" onclick="loadExample('crypto')">‚Çø Crypto Mix</button>
        </div>
        <button onclick="document.getElementById('onboardingBanner').style.display='none'" style="position:absolute;top:8px;right:10px;background:none;border:none;color:var(--muted);font-size:14px;cursor:pointer;line-height:1;padding:2px 5px;border-radius:3px;transition:color 0.15s;" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--muted)'">√ó</button>
      </div>


      <!-- Portfolio overview chart (shown when a portfolio is loaded) -->
      <div id="portfolioOverviewChart" style="display:none"></div>

      <!-- Screenshot upload (collapsible) -->
      <div id="inputSections">
      <div class="upload-compact-trigger" onclick="expandUploadZone(this)">
        <span class="upload-compact-icon">üì∑</span>
        <span>Import from screenshots</span>
        <span class="upload-compact-chevron">‚ñ∏</span>
      </div>
      <div class="upload-expanded" id="uploadExpanded">
      <div class="upload-zone" id="uploadZone">
        <input type="file" accept="image/*" multiple onchange="handleScreenshot(event)" />
        <div class="upload-icon">üì∑</div>
        <div class="upload-text"><strong>Drop or tap to upload screenshots</strong><br>Large portfolios? Just snap several pics!</div>
        <div class="scanning-overlay" id="scanningOverlay">
          <div class="scan-spinner"></div>
          <div class="scan-text" id="scanText">Scanning portfolio...</div>
        </div>
      </div>
      </div>

      <!-- Import preview -->
      <div class="import-preview" id="importPreview">
        <div class="import-preview-header">
          <span class="import-note" id="importNote"></span>
          <button class="btn-import-all" onclick="importAll()">Add All</button>
        </div>
        <div class="preview-items" id="previewItems"></div>
      </div>

      <!-- Manual input -->
      <div id="manualInputLabel" style="padding:0 24px;"><div style="font-family:'Space Mono',monospace;font-size:10px;color:#5a6478;letter-spacing:0.5px;text-transform:uppercase;margin-bottom:6px;">Or enter manually</div></div>
      <div class="stock-form">
        <div class="input-row">
          <div class="autocomplete-wrapper" style="position:relative;flex:1;">
            <input type="text" id="tickerInput" placeholder="Ticker (e.g. AAPL)" maxlength="6" style="text-transform:uppercase" autocomplete="off" />
            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
          </div>
          <input type="number" id="pctInput" placeholder="%" min="0.1" max="100" step="0.1" />
        </div>
        <button class="btn-add" onclick="addStock()">+</button>
        <div class="error-msg" id="errorMsg"></div>
      </div>
      </div>

      <div class="holdings-view-toggle" id="holdingsViewToggle" style="display:none">
        <span class="holdings-label" onclick="toggleHoldingsGrid()" style="cursor:pointer;">Your Holdings <span id="holdingsGridChevron" style="font-size:10px;color:var(--muted);transition:transform 0.2s;display:inline-block;">&#9662;</span></span>
        <button class="view-btn" onclick="setHoldingsView('list')" data-view="list">List</button>
        <button class="view-btn active" onclick="setHoldingsView('chart')" data-view="chart">Charts</button>
        <span class="holdings-market-status" id="holdingsMarketStatus"></span>
        <button class="pstrip-refresh" id="pstripRefresh" onclick="refreshPortfolioStrip()" title="Refresh prices">&#8635;</button>
      </div>
      <div class="stock-list" id="stockList"></div>

      <div class="portfolio-summary">
        <span class="summary-chip" id="summaryChip">0% allocated</span>
      </div>

      <!-- Risk score -->
      <div class="risk-score-bar" id="riskScoreBar" style="display:none">
        <span class="risk-score-label">Portfolio Risk</span>
        <div class="risk-score-track"><div class="risk-score-fill" id="riskScoreFill"></div></div>
        <span class="risk-score-num" id="riskScoreNum"></span>
      </div>

      <!-- Correlation warnings -->
      <div class="correlation-warnings" id="corrWarnings"></div>

      <!-- What-if simulator -->
      <div class="whatif-panel" id="whatifPanel" style="display:none">
        <div class="whatif-header" onclick="toggleWhatIf()">
          <span class="whatif-title">‚ö° What-If Simulator ‚Äî test a new position</span>
          <span class="whatif-toggle" id="whatifToggleIcon">‚ñ∏ expand</span>
        </div>
        <div class="whatif-body" id="whatifBody">
          <div class="whatif-row">
            <div class="autocomplete-wrapper" style="position:relative;flex:1;">
              <input type="text" id="whatifTicker" placeholder="Add ticker..." maxlength="6" style="text-transform:uppercase" autocomplete="off" />
              <div class="autocomplete-dropdown" id="whatifAutocompleteDropdown"></div>
            </div>
            <input type="number" id="whatifPct" placeholder="%" min="0.1" max="100" step="0.1" />
          </div>
          <div class="whatif-result" id="whatifResult">Enter a ticker to preview its impact on your portfolio.</div>
        </div>
      </div>

      <button class="btn-analyze" id="analyzeBtn" onclick="analyzeDebounced()" disabled>
        Analyze
      </button>
      </div><!-- /holdingsBody -->
    </div>
  </div>

  <!-- Right: Results Panel -->
  <div>
    <div class="results-panel" id="resultsPanel">
      <div class="empty-state">
        <div class="empty-compass">
          <div class="empty-compass-ring"></div>
          <div class="empty-compass-needle"></div>
          <div class="empty-compass-center"></div>
        </div>
        <div class="empty-state-title">Ready to analyze</div>
        <div class="empty-state-hint">Add your US stock holdings on the left, then click<br><strong>Analyze</strong></div>
      </div>
    </div>
  </div>
</div>


<!-- Bottom Nav Bar -->
<nav class="bottom-bar" id="bottomBar">
  <button class="bottom-bar-tab active" onclick="navTo('portfolios')" id="navPortfolios">
    <svg class="bottom-bar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
    <span>Portfolios</span>
  </button>
  <button class="bottom-bar-tab" onclick="navTo('explore')" id="navExplore">
    <svg class="bottom-bar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="16.24,7.76 14.12,14.12 7.76,16.24 9.88,9.88"/></svg>
    <span>Explore</span>
  </button>
  <button class="bottom-bar-tab" onclick="navTo('news')" id="navNews">
    <svg class="bottom-bar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 002-2V4a2 2 0 00-2-2H8a2 2 0 00-2 2v16a2 2 0 01-2 2zm0 0a2 2 0 01-2-2v-9c0-1.1.9-2 2-2h2"/><line x1="10" y1="6" x2="18" y2="6"/><line x1="10" y1="10" x2="18" y2="10"/><line x1="10" y1="14" x2="14" y2="14"/></svg>
    <span>News</span>
  </button>
  <button class="bottom-bar-tab" onclick="navTo('user')" id="navUser">
    <svg class="bottom-bar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    <span>Account</span>
  </button>
</nav>

  <div class="share-toast" id="shareToast">üîó Link copied to clipboard!</div>

<!-- AUTH MODAL -->
<div id="authModal" style="display:none;position:fixed;inset:0;z-index:200000;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);" onclick="if(event.target===this)closeAuthModal()">
  <div style="background:#0f1318;border:1px solid #1e2430;border-radius:16px;padding:36px 32px;max-width:360px;width:90%;font-family:Inter,sans-serif;position:relative;">
    <button onclick="closeAuthModal()" style="position:absolute;top:14px;right:16px;background:none;border:none;color:#8a9ab8;font-size:18px;cursor:pointer;">√ó</button>
    <div style="text-align:center;margin-bottom:20px;">
      <h2 style="color:#e8ecf0;font-size:20px;font-weight:700;margin:0 0 6px;">Sign In</h2>
      <p style="color:#8a9ab8;font-size:12px;margin:0;">Save portfolios & sync across devices</p>
    </div>
    <!-- Google Sign In ‚Äî GIS renders its own button here -->
    <div id="googleSignInContainer" style="display:none;width:100%;min-height:44px;margin-bottom:0;"></div>
    <button id="googleSignInFallback" onclick="googleSignIn()" style="width:100%;padding:11px;border-radius:10px;border:1px solid #2a2f3e;background:#1a1f2e;color:#e8ecf0;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;font-family:Inter,sans-serif;">
      <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Continue with Google
    </button>
    <!-- Apple Sign In -->
    <button onclick="closeAuthModal();appleSignIn()" style="width:100%;padding:11px;border-radius:10px;border:1px solid #2a2f3e;background:#000;color:#fff;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;font-family:Inter,sans-serif;margin-top:8px;">
      <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#fff" d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/></svg>
      Continue with Apple
    </button>
  </div>
</div>

<!-- PAYWALL MODAL -->
<div id="paywallModal" style="display:none;position:fixed;inset:0;z-index:99999;align-items:center;justify-content:center;background:rgba(0,0,0,0.75);backdrop-filter:blur(6px);" onclick="if(event.target===this)closePaywall()">
  <div class="pw-card">
    <button onclick="closePaywall()" class="pw-close">√ó</button>

    <!-- Hero -->
    <div class="pw-hero">
      <div class="pw-icon-ring">
        <svg width="24" height="24" viewBox="0 0 48 48" fill="none">
          <polygon points="24,6 28,22 24,19 20,22" fill="#00e5a0"/>
          <polygon points="24,42 28,26 24,29 20,26" fill="#a78bfa" opacity="0.7"/>
          <circle cx="24" cy="24" r="2.5" fill="#fff"/>
        </svg>
      </div>
      <h2 class="pw-title">Upgrade to Pro</h2>
      <p id="paywallMsg" class="pw-subtitle"></p>
    </div>

    <!-- Features -->
    <div class="pw-features">
      <div class="pw-feat"><span class="pw-check">&#10003;</span>Unlimited AI analysis</div>
      <div class="pw-feat"><span class="pw-check">&#10003;</span>Screenshot import</div>
      <div class="pw-feat"><span class="pw-check">&#10003;</span>Expanded stock &amp; ETF picks</div>
      <div class="pw-feat"><span class="pw-check">&#10003;</span>PDF export &amp; sharing</div>
      <div class="pw-feat"><span class="pw-check">&#10003;</span>Cloud sync</div>
      <div class="pw-feat"><span class="pw-check">&#10003;</span>Unlimited portfolios</div>
    </div>

    <!-- Tiers -->
    <div class="pw-tiers" id="pwTiers">
      <div id="tier-monthly" class="pw-tier pw-tier-selected" data-tier="monthly">
        <div class="pw-tier-badge">Popular</div>
        <div class="pw-tier-name">Monthly</div>
        <div class="pw-tier-price"></div>
        <div class="pw-tier-note">Cancel anytime</div>
      </div>
      <div id="tier-annual" class="pw-tier" data-tier="annual">
        <div class="pw-tier-badge pw-tier-badge-save">Save 37%</div>
        <div class="pw-tier-name">Annual</div>
        <div class="pw-tier-price"></div>
        <div class="pw-tier-note">Billed yearly</div>
      </div>
      <div id="tier-lifetime" class="pw-tier" data-tier="lifetime">
        <div class="pw-tier-badge pw-tier-badge-deal">Best Deal</div>
        <div class="pw-tier-name">Lifetime</div>
        <div class="pw-tier-price"></div>
        <div class="pw-tier-note">Pay once, own forever</div>
      </div>
    </div>

    <!-- CTA -->
    <button id="paywallConfirmBtn" class="pw-cta"></button>
    <button onclick="restorePurchases()" class="pw-restore">Restore Purchases</button>
  </div>
</div>

<footer style="text-align:center;padding:24px 0 12px;font-family:'Space Mono',monospace;font-size:9px;color:#5a6478;">
  <a href="/privacy.html" style="color:#5a6478;text-decoration:none;">Privacy Policy</a> &middot; <a href="/terms.html" style="color:#5a6478;text-decoration:none;">Terms of Service</a> &middot; <a href="/support.html" style="color:#5a6478;text-decoration:none;">Support</a>
</footer>

<script src="/data.js"></script>
<script src="/app.js"></script>
<script src="/patches.js"></script>
<script>
(function(){
  var splash = document.getElementById('splashLoader');
  if (!splash) return;
  function dismiss() {
    splash.classList.add('fade-out');
    setTimeout(function(){ splash.remove(); }, 400);
  }
  var minTime = new Promise(function(r) { setTimeout(r, 1200); });
  var loaded = new Promise(function(r) {
    if (document.readyState === 'complete') r();
    else window.addEventListener('load', r);
  });
  Promise.all([minTime, loaded]).then(dismiss);
})();
</script>
</body>
</html>
