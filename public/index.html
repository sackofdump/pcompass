<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Portfolio Compass</title>
<meta name="description" content="Analyze your stock portfolio, get AI-powered recommendations, and track sector exposure.">
<meta name="theme-color" content="#0a0c10">
<meta property="og:title" content="Portfolio Compass ‚Äî AI Stock Portfolio Analyzer">
<meta property="og:description" content="Enter your holdings, get personalized AI-powered stock & ETF recommendations. See your risk level, diversification score, and sector gaps instantly.">
<meta property="og:image" content="https://pcompass.vercel.app/icons/icon-512.png">
<meta property="og:url" content="https://pcompass.vercel.app">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Portfolio Compass ‚Äî AI Stock Portfolio Analyzer">
<meta name="twitter:description" content="Enter your holdings, get personalized AI-powered stock & ETF recommendations.">
<meta name="twitter:image" content="https://pcompass.vercel.app/icons/icon-512.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-192.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-192.png">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="PCompass">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<!-- Google Sign-In loaded lazily in showAuthModalOptimized() -->
<link rel="stylesheet" href="/styles.css">
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">
      <div class="logo-icon-center"></div>
    </div>
    <h1>Portfolio <span>Compass</span></h1>
  </div>
  <div class="tagline">Portfolio Diversification &amp; Strategy Analyzer</div>
  <div class="header-actions">
    <!-- Pro button -->
    <button onclick="showPaywall('header')" id="btnPro" class="btn-pro">‚ú¶ Pro</button>
    <!-- Logged out: sign in button -->
    <button id="btnSignIn" onclick="showAuthModalOptimized()" class="btn-signin">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v2h20v-2c0-3.3-6.7-5-10-5z" fill="currentColor"/></svg>
      Sign In
      <!-- Perks tooltip -->
      <div id="signinPerks" class="signin-perks-tooltip">
        <div class="perks-title">Sign in to unlock</div>
        <div class="perks-list">
          <div class="perk-item"><span class="perk-check">‚úì</span> Save portfolios to cloud</div>
          <div class="perk-item"><span class="perk-check">‚úì</span> Sync across devices</div>
          <div class="perk-item"><span class="perk-pro">‚ú¶</span> Pro: Unlimited AI insights</div>
          <div class="perk-item"><span class="perk-pro">‚ú¶</span> Pro: Screenshot import</div>
          <div class="perk-item"><span class="perk-pro">‚ú¶</span> Pro: PDF export</div>
        </div>
        <div class="perks-footer">Free to join ¬∑ Pro from $1.99/mo</div>
      </div>
    </button>
    <!-- Logged in: avatar -->
    <div id="userAvatar" class="user-avatar-wrapper" onclick="toggleUserMenu()">
      <img id="userAvatarImg" src="" class="user-avatar-img" />
      <div id="userMenu" class="user-menu">
        <div id="userMenuName" class="user-menu-name"></div>
        <div id="userMenuEmail" class="user-menu-email"></div>
        <div id="userMenuProStatus" class="user-menu-pro"></div>
        <button onclick="syncPortfoliosFromCloud()" class="user-menu-btn">‚òÅÔ∏è Sync from Cloud</button>
        <button onclick="restorePurchases()" class="user-menu-btn">üîÑ Restore Purchases</button>
        <button onclick="signOut()" class="user-menu-btn user-menu-btn-danger">Sign Out</button>
      </div>
    </div>
  </div>
  <div class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
    <span id="themeLabel">DARK</span>
    <div class="theme-toggle-track">
      <div class="theme-toggle-thumb"></div>
    </div>
  </div>
</header>

<div class="main-grid container">
  <!-- Left: Input Panel -->
  <div>
    <div class="panel">
      <div class="panel-header" style="display:flex;align-items:center;justify-content:space-between;">
        <h2>Your Holdings</h2>
        <div style="display:flex;gap:6px;">
          <button class="slot-btn" onclick="sharePortfolio()" title="Share portfolio link">üîó</button>
          <button class="slot-btn" onclick="exportPDF()" title="Export PDF">‚¨á</button>
        </div>
      </div>

      <!-- Onboarding banner -->
      <div class="onboarding-banner" id="onboardingBanner" style="position:relative;">
        <div class="onboarding-text">üëã <strong>Welcome!</strong> Add your stock holdings below, or try an example portfolio to see how it works.</div>
        <div class="onboarding-examples">
          <button class="btn-example" onclick="loadExample('tech')">üöÄ Tech Heavy</button>
          <button class="btn-example" onclick="loadExample('balanced')">‚öñÔ∏è Balanced</button>
          <button class="btn-example" onclick="loadExample('conservative')">üõ°Ô∏è Conservative</button>
          <button class="btn-example" onclick="loadExample('crypto')">‚Çø Crypto Mix</button>
        </div>
        <button class="btn-close-onboarding" onclick="document.getElementById('onboardingBanner').style.display='none'">√ó</button>
      </div>

      <!-- Portfolio save/load -->
      <div class="portfolio-manager" id="portfolioManager">
        <div class="portfolio-slots" id="portfolioSlots"></div>
        <div class="pm-actions">
          <button class="btn-pm" onclick="savePortfolio()">Ôºã Save Portfolio</button>
          <button class="btn-pm btn-pm-clear" id="btnClearAll" onclick="clearAllHoldings()" style="display:none;">‚úï Clear All</button>
        </div>
      </div>

      <!-- Screenshot upload -->
      <div class="upload-zone" id="uploadZone">
        <input type="file" accept="image/*" multiple onchange="handleScreenshot(event)" />
        <div class="upload-icon">üì∑</div>
        <div class="upload-text"><strong>Import from screenshots</strong><br>Upload one or multiple screenshots<br>Large portfolios? Just snap several pics!</div>
        <div class="scanning-overlay" id="scanningOverlay">
          <div class="scan-spinner"></div>
          <div class="scan-text" id="scanText">Scanning portfolio...</div>
        </div>
      </div>

      <!-- Import preview -->
      <div class="import-preview" id="importPreview">
        <div class="import-preview-header">
          <span class="import-note" id="importNote"></span>
          <button class="btn-import-all" onclick="importAll()">Add All</button>
        </div>
        <div class="preview-items" id="previewItems"></div>
      </div>

      <!-- Manual input -->
      <div class="stock-form">
        <div class="input-row">
          <div class="autocomplete-wrapper">
            <input type="text" id="tickerInput" placeholder="Ticker (e.g. AAPL)" maxlength="6" style="text-transform:uppercase" autocomplete="off" />
            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
          </div>
          <input type="number" id="pctInput" placeholder="%" min="0.1" max="100" step="0.1" />
        </div>
        <button class="btn-add" onclick="addStock()">+</button>
        <div class="error-msg" id="errorMsg"></div>
      </div>

      <div class="stock-list" id="stockList"></div>

      <div class="portfolio-summary">
        <span class="summary-chip" id="summaryChip">0% allocated</span>
      </div>

      <!-- Risk score -->
      <div class="risk-score-bar" id="riskScoreBar" style="display:none">
        <span class="risk-score-label">Portfolio Risk</span>
        <div class="risk-score-track"><div class="risk-score-fill" id="riskScoreFill"></div></div>
        <span class="risk-score-num" id="riskScoreNum"></span>
      </div>

      <!-- Correlation warnings -->
      <div class="correlation-warnings" id="corrWarnings"></div>

      <!-- What-if simulator -->
      <div class="whatif-panel" id="whatifPanel" style="display:none">
        <div class="whatif-header" onclick="toggleWhatIf()">
          <span class="whatif-title">‚ö° What-If Simulator ‚Äî test a new position</span>
          <span class="whatif-toggle" id="whatifToggleIcon">‚ñ∏ expand</span>
        </div>
        <div class="whatif-body" id="whatifBody">
          <div class="whatif-row">
            <input type="text" id="whatifTicker" placeholder="Add ticker..." maxlength="6" style="text-transform:uppercase" />
            <input type="number" id="whatifPct" placeholder="%" min="0.1" max="100" step="0.1" />
          </div>
          <div class="whatif-result" id="whatifResult">Enter a ticker to preview its impact on your portfolio.</div>
        </div>
      </div>

      <button class="btn-analyze" id="analyzeBtn" onclick="analyzeDebounced()" disabled>
        Analyze &amp; Recommend
      </button>
    </div>
  </div>

  <!-- Right: Results Panel -->
  <div>
    <div class="results-panel" id="resultsPanel">
      <div class="empty-state">
        <div class="placeholder-icon">üß≠</div>
        <div class="placeholder-text">
          Add your US stock holdings<br>on the left, then click<br>
          <strong style="color:var(--text)">Analyze &amp; Recommend</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Upgrade Modal -->
<div class="upgrade-modal" id="upgradeModal">
  <div class="upgrade-box">
    <button class="upgrade-close" onclick="closeUpgradeModal()">&times;</button>
    <div class="upgrade-icon">üß≠</div>
    <div class="upgrade-title">Unlock more portfolios</div>
    <div class="upgrade-sub">You've hit the <strong style="color:var(--text)">3 portfolio</strong> limit on the free plan.<br>Upgrade to save unlimited portfolios and unlock Pro features.</div>
    <div class="upgrade-tiers">
      <div class="upgrade-tier">
        <div>
          <div class="upgrade-tier-name">Free</div>
          <div class="upgrade-tier-desc">3 AI explanations ¬∑ 3 screenshot imports ¬∑ All analysis tools</div>
        </div>
        <div class="upgrade-tier-price" style="color:var(--muted)">$0</div>
      </div>
      <div class="upgrade-tier featured">
        <div>
          <div class="upgrade-tier-name">Pro ‚ú¶</div>
          <div class="upgrade-tier-desc">Unlimited AI insights ¬∑ Screenshot import ¬∑ PDF export</div>
        </div>
        <div class="upgrade-tier-price">$1.99<span>/mo</span></div>
      </div>
      <div class="upgrade-tier" style="border-color:#a78bfa40;">
        <div>
          <div class="upgrade-tier-name">Pro Annual <span style="font-size:9px;color:#a78bfa;font-weight:400;">Save 37%</span></div>
          <div class="upgrade-tier-desc">Everything in Pro ¬∑ Billed yearly</div>
        </div>
        <div class="upgrade-tier-price" style="color:#a78bfa">$14.99<span>/yr</span></div>
      </div>
      <div class="upgrade-tier">
        <div>
          <div class="upgrade-tier-name">Lifetime</div>
          <div class="upgrade-tier-desc">Everything in Pro ¬∑ Pay once, own forever</div>
        </div>
        <div class="upgrade-tier-price" style="color:#a78bfa">$19.99<span> one-time</span></div>
      </div>
    </div>
    <div class="upgrade-actions">
      <button class="btn-upgrade-cta" onclick="goToPurchase('https://buy.stripe.com/28E8wPb66b4Y4aj0M96AM03')">Get Pro ‚Äî $1.99/mo</button>
      <button class="btn-upgrade-secondary" onclick="goToPurchase('https://buy.stripe.com/28EdR94HIc926ir66t6AM05')" style="color:#a78bfa">Annual ‚Äî $14.99/yr (save 37%)</button>
      <button class="btn-upgrade-secondary" onclick="goToPurchase('https://buy.stripe.com/14AeVddeedd64aj3Yl6AM04')">Lifetime ‚Äî $19.99</button>
    </div>
    <div class="upgrade-free-note">Delete a saved portfolio to save a new one on the free plan.</div>
    <div style="text-align:center;margin-top:8px;"><button onclick="restorePurchases()" class="btn-restore-inline">Restore Purchases</button></div>
  </div>
</div>

<div class="share-toast" id="shareToast">üîó Link copied to clipboard!</div>

<!-- Auth Modal -->
<div id="authModal" class="modal-overlay" onclick="if(event.target===this)closeAuthModal()">
  <div class="modal-box auth-modal-box">
    <button onclick="closeAuthModal()" class="modal-close">√ó</button>
    <div class="modal-header-center">
      <h2>Sign In</h2>
      <p>Save portfolios & sync across devices</p>
    </div>
    <button onclick="closeAuthModal();googleSignIn()" class="btn-google-signin">
      <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Continue with Google
    </button>
    <div class="auth-divider">
      <div class="auth-divider-line"></div>
      <span>OR</span>
      <div class="auth-divider-line"></div>
    </div>
    <div id="authFormFields">
      <input type="email" id="authEmail" placeholder="Email address" class="auth-input" />
      <input type="password" id="authPassword" placeholder="Password" class="auth-input" />
      <input type="password" id="authPasswordConfirm" placeholder="Confirm password" class="auth-input" style="display:none;" />
      <div id="authError" class="auth-error"></div>
      <button id="authSubmitBtn" onclick="submitEmailAuth()" class="btn-auth-submit">Sign In</button>
    </div>
    <div class="auth-toggle-row">
      <span id="authToggleText">Don't have an account? </span>
      <a href="#" id="authToggleLink" onclick="toggleAuthMode();return false;">Sign Up</a>
    </div>
  </div>
</div>

<!-- Paywall Modal -->
<div id="paywallModal" class="modal-overlay" onclick="if(event.target===this)closePaywall()">
  <div class="modal-box paywall-modal-box">
    <button onclick="closePaywall()" class="modal-close">√ó</button>
    <div class="modal-header-center">
      <svg width="36" height="36" viewBox="0 0 48 48" fill="none" style="margin-bottom:10px;">
        <circle cx="24" cy="24" r="21" stroke="#00e5a0" stroke-width="1.5"/>
        <polygon points="24,8 27,22 24,20 21,22" fill="#00e5a0"/>
        <polygon points="24,40 27,26 24,28 21,26" fill="#ff4d6d" opacity="0.6"/>
        <circle cx="24" cy="24" r="2.5" fill="#e8ecf0"/>
      </svg>
      <h2>Unlock Pro Access</h2>
      <p id="paywallMsg"></p>
      <div class="paywall-features">
        <div class="paywall-features-title">What's included</div>
        <div class="paywall-features-list">
          <div class="perk-item"><span class="perk-check">‚úì</span> Unlimited AI explanations per pick</div>
          <div class="perk-item"><span class="perk-check">‚úì</span> Screenshot portfolio import</div>
          <div class="perk-item"><span class="perk-check">‚úì</span> Expanded stock &amp; ETF picks</div>
          <div class="perk-item"><span class="perk-check">‚úì</span> PDF export &amp; portfolio sharing</div>
          <div class="perk-item"><span class="perk-check">‚úì</span> Cloud sync across devices</div>
          <div class="perk-item"><span class="perk-check">‚úì</span> Unlimited saved portfolios</div>
        </div>
      </div>
    </div>
    <div class="paywall-tiers">
      <div class="paywall-tier paywall-tier-featured">
        <div><div class="paywall-tier-name">Pro ‚ú¶</div><div class="paywall-tier-desc">Unlimited AI ¬∑ Screenshot import ¬∑ PDF export</div></div>
        <div class="paywall-tier-price paywall-price-accent">$1.99<span>/mo</span></div>
      </div>
      <div class="paywall-tier">
        <div><div class="paywall-tier-name">Annual <span class="paywall-save-badge">Save 37%</span></div><div class="paywall-tier-desc">Everything in Pro ¬∑ Billed yearly</div></div>
        <div class="paywall-tier-price paywall-price-purple">$14.99<span>/yr</span></div>
      </div>
      <div class="paywall-tier">
        <div><div class="paywall-tier-name">Lifetime</div><div class="paywall-tier-desc">Pay once, own forever</div></div>
        <div class="paywall-tier-price paywall-price-purple">$19.99</div>
      </div>
    </div>
    <div class="paywall-actions">
      <button onclick="goToPurchase('https://buy.stripe.com/28E8wPb66b4Y4aj0M96AM03')" class="btn-upgrade-cta">Get Pro ‚Äî $1.99/mo</button>
      <button onclick="goToPurchase('https://buy.stripe.com/28EdR94HIc926ir66t6AM05')" class="btn-upgrade-secondary" style="color:#a78bfa">Annual ‚Äî $14.99/yr (save 37%)</button>
      <button onclick="goToPurchase('https://buy.stripe.com/14AeVddeedd64aj3Yl6AM04')" class="btn-upgrade-secondary">Lifetime ‚Äî $19.99</button>
      <button onclick="restorePurchases()" class="btn-restore-inline">Restore Purchases</button>
    </div>
  </div>
</div>

<!-- JS: Data first, then app logic, then patches -->
<script src="/data.js"></script>
<script src="/app.js"></script>
<script src="/patches.js"></script>
</body>
</html>
